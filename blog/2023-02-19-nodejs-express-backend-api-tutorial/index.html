<!doctype html>
<html lang="ko" data-bs-theme="auto">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="preload" href="https://mycodingshub.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://mycodingshub.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://mycodingshub.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2" as="font" type="font/woff2" crossorigin>
<script 
  src="/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js"
  integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg=">
</script>


<link rel="stylesheet" href="/main.86b7305f5a96b7dd3a46fa6277d87b125af3bf13f48c4cfcc269be84fa9e8fb75375d45a5fe9056ce9190644b7a6e5f13f917f12d853ed38bb76d8856898f755.css" integrity="sha512-hrcwX1qWt906Rvpid9h7ElrzvxP0jEz8wmm+hPqej7dTddRaX+kFbOkZBkS3puXxP5F/EthT7Ti7dtiFaJj3VQ==" crossorigin="anonymous">

<noscript><style>img.lazyload { display: none; }</style></noscript><title>Nodejs Express Backend API 강좌 1편 - Auth</title>
<meta name="description" content="1편. Auth 설정 - Nodejs Express 프레임워크로 만드는 서버 강좌" />
<link rel="canonical" href="https://mycodingshub.github.io/blog/2023-02-19-nodejs-express-backend-api-tutorial/" />
<meta name="robots" content="index, follow" />

<meta property="og:type" content="article" />
<meta property="og:title" content="Nodejs Express Backend API 강좌 1편 - Auth" />
<meta property="og:description" content="1편. Auth 설정 - Nodejs Express 프레임워크로 만드는 서버 강좌" />
<meta property="og:url" content="https://mycodingshub.github.io/blog/2023-02-19-nodejs-express-backend-api-tutorial/" />
<meta property="og:site_name" content="Home" />
<meta property="og:image" content="https://mycodingshub.github.io/cover.png" />
<meta property="og:locale" content="en" />
<meta property="article:published_time" content="2023-02-19T10:04:45Z" />
<meta property="article:modified_time" content="2023-02-19T10:04:45Z" />
<meta property="article:tag" content="nodejs" />
<meta property="article:tag" content="express" />
<meta property="article:tag" content="expressjs" />
<meta property="article:tag" content="prisma" />
<meta property="article:tag" content="api" />
<meta property="article:tag" content="auth" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Nodejs Express Backend API 강좌 1편 - Auth" />
<meta name="twitter:description" content="1편. Auth 설정 - Nodejs Express 프레임워크로 만드는 서버 강좌" />
<meta name="twitter:image" content="https://mycodingshub.github.io/cover.png" />

<meta name="author" content="cpro95@gmail.com" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "\"Nodejs Express Backend API 강좌 1편 - Auth\"",
  "description": "\"1편. Auth 설정 - Nodejs Express 프레임워크로 만드는 서버 강좌\"",
  "datePublished": "\"2023-02-19T10:04:45Z\"",
  "dateModified": "\"2023-02-19T10:04:45Z\"",
  "author": {
    "@type": "Person",
    "name": "\"cpro95@gmail.com\""
  },
  "image": "\"https://mycodingshub.github.io/cover.png\"",
  "url": "\"https://mycodingshub.github.io/blog/2023-02-19-nodejs-express-backend-api-tutorial/\"",
  "publisher": {
    "@type": "Organization",
    "name": "\"Home\""
  }
}
</script>




<script async src="https://www.googletagmanager.com/gtag/js?id=G-C7SBETWEJ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C7SBETWEJ0');
</script>


<script
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7748316956330968"
  crossOrigin="anonymous"
></script>


</head>

  
  <body class="single section blog" data-bs-spy="scroll" data-bs-target="#toc" data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll="true" tabindex="0">
    <div class="sticky-top">
<header class="navbar navbar-expand-sm">
  <div class="container-lg">
  <div class="d-flex flex-grow-1 justify-content-between">
    <div class="d-flex flex-row navbar-nav justify-content-between align-items-start gap-2">
    
    <a class="nav-link fw-bold fs-4" href="/">Home</a>

    
    
            <a class="nav-link fs-4  active" href="https://mycodingshub.github.io/blog/" aria-current="true">Blog</a>
          
        
            <a class="nav-link fs-4 " href="https://mycodingshub.github.io/life/">Life</a>
          
        
    </div>
    <div class="d-flex flex-row justify-content-between align-items-center">
      
      
      <button type="button" id="searchToggleMobile" class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
      </button>
      
      
      <button type="button" id="searchToggleDesktop" class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
      </button>
      
      <button id="buttonColorMode" class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type="button" aria-label="Toggle theme">
        <svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
        </svg>
        <svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0m-5 0h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path>
        </svg>
      </button>
      </div>
        
        
        
        
        </div>
    </div>

    
    </div>
</header>
</div>

<div class="modal" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5 visually-hidden" id="searchModalLabel">Search</h1>
        <button type="button" class="btn-close visually-hidden" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="search-input flex-grow-1 d-none">
          <form id="search-form" class="search-form" action="#" method="post" accept-charset="UTF-8" role="search">
            <label for="query" class="visually-hidden">Search</label>
            <div class="d-flex">
              <input type="search" id="query" name="query" class="search-text form-control form-control-lg" placeholder="Search" aria-label="Search" maxlength="128" autocomplete="off">
              <button type="button" class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss="modal" aria-label="Close">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-body">
        <p class="search-loading status message d-none mt-3 text-center">Loading search index…</p>
        <p class="search-no-recent message d-none mt-3 text-center">No recent searches</p>
        <p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class="query-no-results">Query here</span></strong>"</p>
        <div id="searchResults" class="search-results"></div>
        <template>
          <article class="search-result list-view">
            <div class="card my-3">
              <div class="card-body">
                <header>
                  <h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href="#">Title here</a></h2>
                  <div class="submitted d-none"><time class="created-date">Date here</time></div>
                </header>
                <div class="content">Summary here</div>
              </div>
            </div>
          </article>
        </template>
      </div>
      <div class="modal-footer">
        <ul class="list-inline me-auto d-none d-md-block">
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4M7 11.53088l-3-3 3-3"></path></g></svg></kbd><span class="DocSearch-Label">to select</span></li>
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8M10.5 8.5l-3 3-3-3"></path></g></svg></kbd><kbd class="me-2"><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8M10.5 6.5l-3-3-3 3"></path></g></svg></kbd><span class="DocSearch-Label">to navigate</span></li>
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956"></path></g></svg></kbd><span class="DocSearch-Label">to close</span></li>
        </ul>
        <p class="d-md-none">Search by <a class="text-decoration-none" href="https://github.com/nextapps-de/flexsearch">FlexSearch</a></p>
      </div>
    </div>
  </div>
</div>


    <div class="wrap container-lg" role="document">
      <div class="content">
      
        
<article>
  <div class="row justify-content-center">
    <div class="col-md-12 col-lg-12">
      
      <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-7748316956330968"
        data-ad-slot="2971373181"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      <div class="blog-header">
        <h1>Nodejs Express Backend API 강좌 1편 - Auth</h1>
        <p>
  <small>February 19, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>21&nbsp;minutes</span></small>
</p>

      </div>
    </div>
      <div class="col-md-12 col-lg-12">
      
      <p>안녕하세요?</p>
<p>기존 Remix Framework으로 FullStack 개발만 해오다가 실제 서버 사이드 벡엔드 개발해보고 싶어 강좌를 시작하게 됐습니다.</p>
<p>Nodejs Express 프레임워크로 개발할 건데요.</p>
<p>순수하게 Backend API 엔드 포인트만 개발하고, 클라이언트는 NextJS로 개발할 계획입니다.</p>
<p>Express 강좌에 있어 가장 기본이 되는 Auth(유저 가입, 로그인, 로그아웃) 부분에 대해 알아볼 예정입니다.</p>
<p>Auth 관련 로직은 JSONWebToken으로 토큰을 발행해 클라이언트 쪽 쿠키에 저장하는 가장 일반적인 방식으로 진행할 예정입니다.</p>
<h2 id="npm-init">NPM Init</h2>
<p>본격적으로 Express 서버 개발에 들어가 볼까요?</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir nodejs-api-test
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nodejs-api-test
</span></span><span class="line"><span class="cl">npm init -y</span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 nodejs-api-test 폴더를 만들고, npm init을 했습니다.</p>
<p>이제 express 서버 개발 관련 패키지를 설치해야 하는데요.</p>
<p>DB 부분은 당연히 요즘 제일 잘 나가는 PRISMA 로 개발할 예정입니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm i express express-validator cors cookie cookie-parser bcrypt dotenv jsonwebtoken @prisma/client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">npm i -D morgan nodemon prisma</span></span></code></pre></div>
  </figure>
</div>
<p>Express 서버 개발에 가장 기본이 되는 패키지인데요.</p>
<p>package.json 파일을 열어 scripts 부분을 아래와 같이 바꿉시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl">  <span class="s2">&#34;scripts&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="s2">&#34;dev&#34;</span><span class="o">:</span> <span class="s2">&#34;nodemon src/server.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="s2">&#34;start&#34;</span><span class="o">:</span> <span class="s2">&#34;node src/server.js&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span></span></span></code></pre></div>
  </figure>
</div>
<h2 id="db-관련-prisma-스키마-파일-만들기">DB 관련 prisma 스키마 파일 만들기</h2>
<p>PRISMA가 진정한 DB 유틸인데요.</p>
<p>mysql, mongodb, postgresql, sqlite3 등 다양한 DB를 지원합니다.</p>
<p>사용방법은 미세하게 차이가 있지만 기본 CRUD 작업은 거의 동일해서 PRISMA 로 개발하고 서버만 바꾸면 손쉽게 확장 가능한 서버를 만들 수 있는데요.</p>
<p>이제 prisma 폴더를 만들고 스키마 파일을 아래와 같이 만듭시다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir prisma
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> prisma
</span></span><span class="line"><span class="cl">touch schema.prisma</span></span></code></pre></div>
  </figure>
</div>
<p>schema.prisma 파일에 아래와 같이 User 모델의 스키마를 세팅합니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">generator</span> <span class="nx">client</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">provider</span> <span class="o">=</span> <span class="s2">&#34;prisma-client-js&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">datasource</span> <span class="nx">db</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">provider</span> <span class="o">=</span> <span class="s2">&#34;sqlite&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">url</span>      <span class="o">=</span> <span class="s2">&#34;file:./dev.db&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">model</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">id</span>           <span class="nb">String</span>   <span class="err">@</span><span class="nx">id</span> <span class="err">@</span><span class="k">default</span><span class="p">(</span><span class="nx">uuid</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nx">firstName</span>    <span class="nb">String</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lastName</span>     <span class="nb">String</span><span class="o">?</span>
</span></span><span class="line"><span class="cl">    <span class="nx">email</span>        <span class="nb">String</span>   <span class="err">@</span><span class="nx">unique</span>
</span></span><span class="line"><span class="cl">    <span class="nx">password</span>     <span class="nb">String</span>
</span></span><span class="line"><span class="cl">    <span class="nx">gender</span>       <span class="nb">String</span>   <span class="err">@</span><span class="k">default</span><span class="p">(</span><span class="s2">&#34;MALE&#34;</span><span class="p">)</span> <span class="c1">// MALE, FEMALE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">coverImage</span>   <span class="nb">String</span><span class="o">?</span>
</span></span><span class="line"><span class="cl">    <span class="nx">profileImage</span> <span class="nb">String</span><span class="o">?</span>
</span></span><span class="line"><span class="cl">    <span class="nx">status</span>       <span class="nb">String</span>   <span class="err">@</span><span class="k">default</span><span class="p">(</span><span class="s2">&#34;LOGOUT&#34;</span><span class="p">)</span> <span class="c1">// ACTIVE, IDLE, LOGOUT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">createdAt</span>    <span class="nx">DateTime</span> <span class="err">@</span><span class="k">default</span><span class="p">(</span><span class="nx">now</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nx">updatedAt</span>    <span class="nx">DateTime</span> <span class="err">@</span><span class="nx">updatedAt</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>우리가 개발하려고 한 익스프레스 서버에서 사용자의 가입, 로그인, 로그아웃 부분을 담당할 User 모델입니다.</p>
<p>firstName, lastName, email, password, gender 등을 설정했고요.</p>
<p>나중에 확장을 위해 coverImage, profileImage 도 일단 만들어 놨습니다.</p>
<p>그리고 로그인했다는 현재 상태를 저장하기 위한 status 항목도 추가했습니다.</p>
<p>여기서는 일단 개발을 위해 sqlite를 선택했습니다.</p>
<p>나중에 postgresql로도 바꿀 수 있으니까 걱정 안 하셔도 됩니다.</p>
<p>이제 db push를 해야지 prisma를 사용할 수 있는데요.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  nodejs-api-test npx prisma db push
</span></span><span class="line"><span class="cl">Prisma schema loaded from prisma/schema.prisma
</span></span><span class="line"><span class="cl">Datasource <span class="s2">&#34;db&#34;</span>: SQLite database <span class="s2">&#34;dev.db&#34;</span> at <span class="s2">&#34;file:./dev.db&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SQLite database dev.db created at file:./dev.db
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">🚀  Your database is now in sync with your Prisma schema. Done in 29ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">✔ Generated Prisma Client <span class="o">(</span>4.10.1 <span class="p">|</span> library<span class="o">)</span> to ./node_modules/@prisma/client in 108ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">➜  nodejs-api-test npx prisma studio
</span></span><span class="line"><span class="cl">Prisma schema loaded from prisma/schema.prisma
</span></span><span class="line"><span class="cl">Prisma Studio is up on http://localhost:5556
</span></span><span class="line"><span class="cl">imports from <span class="s2">&#34;@prisma/client/runtime&#34;</span> are deprecated.
</span></span><span class="line"><span class="cl">Use <span class="s2">&#34;@prisma/client/runtime/library&#34;</span>,  <span class="s2">&#34;@prisma/client/runtime/data-proxy&#34;</span> or  <span class="s2">&#34;@prisma/client/runtime/binary&#34;</span></span></span></code></pre></div>
  </figure>
</div>
<p>prisma studio를 불러놓으면 현재 DB에 뭐가 있는지 쉽게 확인할 수 있어 개발할 때는 꼭 실행하시면 편합니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEi8ligqEuttO6_dzCX_Xg6ejJFZdPYtQ_jh-eOLZjGT2gPjPC7FR4O6bROunld0l5BJa1B2rfCblYF47U6PVpTJmMOdotvIrDq-_Qv6wzrDTDMhLBYAMNynzvPCF3nBW3KpzD0j9MIfUI9ErvRXqqkKVMVUpLEjwAbET-Dv8oTQOMId8p5h9Ph-lyrJ"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEhTgTpgWLfBNqz2FSAwbHj7uurQfa-3LA4Wq3GhsafTjG0F8xHZ3OiQHnLgBzNqJvtviXYyG6Es-MXQPbNuaL-iQCufp4wk31sLhQsL8AXJndg-E2EMhUrhTO-xhe4gUXkGJC9KPXZ0zjPhmTz4wHOtXTIyKzCR7rWwg8ENbzHq-l_PTyuElSWkW5Q9"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위와 같이 브라우저에 prisma studio가 나온다면 일단은 성공입니다.</p>
<h2 id="기타-세팅-파일-먼저-만들기">기타 세팅 파일 먼저 만들기</h2>
<p>익스프레스 서버를 만들기 위해 기타 여러 가지 세팅을 미리 만들어 볼까요?</p>
<p>먼저 <code>.env</code> 파일을 만듭시다.</p>
<p>이게 뭔지는 다들 아실 건데요.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">PORT</span><span class="o">=</span><span class="m">4000</span>
</span></span><span class="line"><span class="cl"><span class="nv">ORIGIN</span><span class="o">=[</span><span class="s2">&#34;http://localhost:3000&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">NODE_ENV</span><span class="o">=</span>development
</span></span><span class="line"><span class="cl"><span class="nv">JWT_SECRET</span><span class="o">=</span><span class="s2">&#34;ajfdhlaksdhkjhqwieryuaksjhfkashfkjashfdkajshfksajhfkjashfqiyruw&#34;</span></span></span></code></pre></div>
  </figure>
</div>
<p>익스프레스 서버 포트는 4000으로 했고요.</p>
<p>cors를 위해 ORIGIN도 배열로 지정했습니다.</p>
<p>그리고 JWT_SECRET도 아무 글자나 길게 설정했고요.</p>
<p>이제, src 폴더를 만들고 config 폴더를 만듭시다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir src
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> src
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mkdir config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">touch env.config.js</span></span></code></pre></div>
  </figure>
</div>
<p>src 폴더가 우리의 서버 전체 소스 파일이 있는 폴더입니다.</p>
<p>그리고 첫 번째로 config 폴더를 만들고 세팅 관련 정보를 모두 저장할 예정입니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="s1">&#39;5000&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ORIGIN</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ORIGIN</span> <span class="o">||</span> <span class="sb">`[&#34;http://localhost:3000&#34;]`</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">NODE_ENV</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">||</span> <span class="s1">&#39;development&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">JWT_SECRET</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span> <span class="o">||</span> <span class="s1">&#39;veylongasdfasdfassecretofmine&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">PORT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ORIGIN</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">NODE_ENV</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">JWT_SECRET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>env.config.js 파일의 내용인데요.</p>
<p><code>.env</code> 파일에서 관련 정보를 불러오고 디폴트 값을 지정해 주는 파일입니다.</p>
<p>별로 어려운 거 없고요.</p>
<hr>
<h2 id="serverjs-파일-만들기">server.js 파일 만들기</h2>
<p>package.json 파일에서도 설정했듯이 우리의 익스프레스 서버의 메인 파일이 바로 src 폴더 바로 밑에 있는 server.js 파일입니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> src
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">touch server.js</span></span></code></pre></div>
  </figure>
</div>
<p>이제 server.js 파일을 express 서버 구동을 위해 작성해 볼까요?</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ORIGIN</span><span class="p">,</span> <span class="nx">NODE_ENV</span><span class="p">,</span> <span class="nx">PORT</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config/env.config&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// init express app
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">httpServer</span> <span class="o">=</span> <span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;development&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">morgan</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;morgan&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// parse incomming request into json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// allow cors for frontend to access api routes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cors</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">credentials</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">origin</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">ORIGIN</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">optionsSuccessStatus</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// parse incomming cookies in request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// server health check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Server is up and running&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// start server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">httpServer</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">))</span></span></span></code></pre></div>
  </figure>
</div>
<p>위 코드가 Nodejs에 있어 express 서버의 가장 기본이 되는 구조입니다.</p>
<p>이제 서버를 돌려볼까요?</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm run dev</span></span></code></pre></div>
  </figure>
</div>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEieSB5zXvy0JG3oUvmHe9cHqJTsnyDKRf3ZuZGQv_sRsDiKXqo964bV31uqQ0GJEUupBbrZnQ0BPQYZac6hxvWs-hnvSRjCoReXZHmyEeJ_uC18qFiM8FpvZDeJV1Pg06lloU2-T7rdEpsYroEtedcwLdXUbWkDmu7qMNfPj3eudOe8OkU93DjiMX26"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjxgWoWoPBJa0T4jl76_p_P3A5A99BrtsdnLd9-F9APB8ieFoYCHeEOIdeJBBsGuYdlg_gYz9imdGg2Z7jVI1a-QMraM0YPDKfvlzvcJ9qnOmKV6f5qazk9IDKBxsseXTcxHhMtZRNG4StsDbgjF_u6TT6JvXSGBtYQvg0Aly5-W7omipZd65EUVBwL"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>실행이 잘 되네요.</p>
<p>그럼, 우리가 뭘 했는지 한번 차근차근 살펴볼까요?</p>
<hr>
<h2 id="http의-작동원리">HTTP의 작동원리</h2>
<p>인터넷에 있는 웹사이트는 기본적으로 HTTP 프로토콜로 움직이는데요.</p>
<p>HTTP는 서버와 클라이언트와의 데이터 이동을 요청과 응답이라는 단순한 로직으로 구현합니다.</p>
<p>요청은 Request라고 하고, 응답은 Response 이라고 합니다.</p>
<p>즉, 클라이언트에서 브라우저에서 사이트 주소를 치면 해당 주소의 서버로 루트 폴더인 &ldquo;/&ldquo;의 index.html 파일을 찾게 됩니다.</p>
<p>여기서 브라우저에서 &ldquo;www.google.com&quot;이라고 주소를 입력했고 엔터를 쳤다면 브라우저가 TCP 커넥션을 통해 서버에 HTTP Request 요청을 보냅니다.</p>
<p>HTTP Request 요청을 받은 서버는 경로가 어딘지를 찾아보는데요.</p>
<p>보통 &ldquo;www.google.com&quot;이라고 주소를 입력하기 때문에 디폴트 경로 값이 &ldquo;/&ldquo;입니다.</p>
<p>즉, 서버의 &ldquo;/&rdquo; 폴더에서 index.html 파일을 요청하게 되는 거죠.</p>
<p>이제 브라우저에서 해당 서버로 요청(Request)이 전달됐고, 그러면 서버는 해당 요청을 서버 로직에서 연산해서 응답(Response)을 도출하게 됩니다.</p>
<p>이제 이 응답(Response)이 클라이언트로 전송되고 브라우저는 이 응답(Response)을 기초로 화면에 정보를 뿌려지게 됩니다.</p>
<h2 id="express-서버에서-request-처리하는-엔드-포인트">Express 서버에서 Request 처리하는 엔드 포인트</h2>
<p>그럼 위에서 우리가 만든 익스프레스 서버로 생각해 본다면 &ldquo;localhost:4000&quot;이라고 브라우저에서 주소를 치면 Request(요청)이 익스프레스 서버로 가는데요.</p>
<p>우리가 위에서 만든 익스프레스 서버는 어떻게 이 요청을 처리할까요?</p>
<p>특히 &ldquo;/&ldquo;처럼 루트 엔드 포인트로 전달한 요청(Request)을 말입니다.</p>
<p>바로 아래 코드에 그 해답이 있는데요.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Server is up and running&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
  </figure>
</div>
<p>app.get() 함수가 바로 HTTP의 엔드 포인트에 따른 요청(Request)을 처리하는 함수입니다.</p>
<p>그럼 get() 함수는 뭘까요?</p>
<p>HTTP의 요청 프로토콜을 5가지가 있는데요.</p>
<p>GET, POST, PUT, PATCH, DELETE 이렇게 다섯 가지가 있습니다.</p>
<p>CRUD라고 들어보셨죠?</p>
<p>Create는 POST HTTP 메소드를 사용하고, Read는 GET 메소드, Update는 PUT, PATCH Delete는 DELETE 메소드를 사용합니다.</p>
<p>POST 메소드를 처리하려면 app.post() 함수를 사용하면 됩니다.</p>
<p>POST 메소드는 클라이언트에서 정보를 첨부해서 서버로 전송할 수 있는데요.</p>
<p>사용자 아이디, 패스워드 같은 걸 JSON 형식으로 전송할 수 있습니다.</p>
<p>그러면 HTTP는 Request는 다음과 같은 형식을 띠게 됩니다.</p>
<p>&ldquo;Content-Type&rdquo;: &ldquo;application/json&rdquo;</p>
<p>json 형식 말고, xml, YAML 형식도 있고, 심지어 Plain이라고 텍스트로 전송할 수도 있습니다.</p>
<p>자바스크립트 세계에서는 json 형식을 가장 많이 쓰니까요. json 형식만 알아 두시면 편합니다.</p>
<p>참고로 GET 메소드는 정보만 얻는 거고, json 형식으로 정보를 전달할 수 없습니다.</p>
<p>GET 메소드에서 서버에 데이터를 전달하는 방식은 URL 파라미터 형식을 사용하는데요.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000/?q=nodejs&amp;page=1&amp;itemsPerPage=10&amp;view=grid
</span></span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 서버 주소에 기다란 텍스트값을 <code>&amp;</code>로 붙여서 전달합니다.</p>
<p>서버에서도 Request 파라미터를 파싱해서 값을 구별할 수 있지만, 위 GET 메소드의 파라미터 데이터 전송은 보통 클라이언트에서 자바스크립트로 코딩할 때 많이 쓰입니다.</p>
<p>자 이제, 다시 우리가 만든 익스프레스 서버를 볼까요?</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Server is up and running&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
  </figure>
</div>
<p>app.get() 함수의 첫 번째 파라미터는 엔드 포인트입니다.</p>
<p>위에서는 &ldquo;/&ldquo;라고 루트 폴더를 지정했네요.</p>
<p>그리고 두 번째는 콜백 함수인데요.</p>
<p>이 &ldquo;/&rdquo; 폴더로 GET 메소드로 요청이 오면 작동하는 함수를 작성하는 겁니다.</p>
<p>이 콜백 함수에서는 익스프레스 프레임워크가 제공하는 Request, Response라는 객체가 있는데요.</p>
<p>보통 이름을 req, res라고 짧게 명명하면 편합니다.</p>
<p>위 코드에서 단순하게 res라는 Response라는 객체를 이용해서 클라이언트로 정보를 제공해 주는데요.</p>
<p>status라는 상태코드를 줄 수 있고 json() 메소드에 원하는 데이터를 묶어서 전송할 수 있습니다.</p>
<p>그래서 우리가 브라우저에서 &ldquo;localhost:4000&quot;이라고 입력하면 나오는 결과물이 위 코드와 같은지 이제 이해가 될 겁니다.</p>
<hr>
<h2 id="익스프레스에서-미들웨어-만들기">익스프레스에서 미들웨어 만들기</h2>
<p>결국은 익스프레스 서버는 여러 엔드포인트에 대한 대응함수만 만들면 되는데요.</p>
<p>app.post(&quot;/api/auth/login&rdquo;), app.post(&quot;/api/auth/signup&rdquo;) 등등 우리의 목적에 맞게 엔드 포인트를 만들면 됩니다.</p>
<p>그러면 우리가 만든 엔드 포인트 말고 전혀 이상한 엔드 포인트로 Request가 오면 어떻게 대처해야 할까요?</p>
<p>익스프레스 프레임워크에는 이걸 대응하는 방법이 있습니다.</p>
<p>바로 미들웨어인데요.</p>
<p>HTTP의 요청, 응답을 해결하기 전에 미들웨어라는 함수를 먼저 실행하는 방식인데요.</p>
<p>일단 아래와 같이 src/middlewares 폴더에 error.middleware.js 파일을 만듭시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">globalErrorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="s1">&#39;Something went wrong&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">status</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">notFoundErrorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">status</span><span class="o">:</span> <span class="mi">404</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;API endpoint does not exists&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>그리고 src/server.js 파일에 아래와 같이 위의 미들웨어를 추가하면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ORIGIN</span><span class="p">,</span> <span class="nx">NODE_ENV</span><span class="p">,</span> <span class="nx">PORT</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config/env.config&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">globalErrorHandler</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">notFoundErrorHandler</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./middlewares/error.middleware&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// init express app
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">httpServer</span> <span class="o">=</span> <span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;development&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">morgan</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;morgan&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// parse incomming request into json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// allow cors for frontend to access api routes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cors</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">credentials</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">origin</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">ORIGIN</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">optionsSuccessStatus</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// parse incomming cookies in request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// server health check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Server is up and running&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// api route not found error handling
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nx">notFoundErrorHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// global error handler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">globalErrorHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// start server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">httpServer</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">))</span></span></span></code></pre></div>
  </figure>
</div>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEhtbP9cl0Tnivtrzl-qUfjjwdMqReXMIhK1wSkZ03DNAvktQ9slUEyBwMPUJbTk_Hkm8b6SDXr0EyiUGcBHjfh86YIphDpv8sGEkq5AYss-jxWWa3XPTZuU5KuYvZMXFFJuEnCCgs84HYf2zDo8weXx4-bDLNQhPOcKCQqMR9e2XTnAoUvbxepfXUFy"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>이제 위와 같이 브라우저 주소창에 &ldquo;localhost:4000/adkfjaksdf&rdquo; 처럼 아무 경로나 치면 위와 같이 에러 처리하는 결과가 나올 겁니다.</p>
<p>그럼, 미들웨어의 작동방식에 대해 알아볼까요?</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">notFoundErrorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">status</span><span class="o">:</span> <span class="mi">404</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;API endpoint does not exists&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>먼저, notFoundErrorHandler입니다.</p>
<p>이건 그냥 error 객체를 만들어서 next() 메소드로 넘겨주면 끝이 납니다.</p>
<p>그러면 next() 메소드가 무엇이냐 하면, 아까 위에서 app.get() 메소드에서 두 번째로 필요한 게 콜백 함수라고 했잖습니까?</p>
<p>바로 그 콜백 함수에 req, res 말고, next라는 미들웨어 처리 함수가 있습니다.</p>
<p>바로 위와 같이 하면 미들웨어를 만들고, 그리고 src/server.js 파일에서 아래와 같이 이상한 경로를 처리하는 코드를 만들어서 주면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// api route not found error handling
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nx">notFoundErrorHandler</span><span class="p">)</span></span></span></code></pre></div>
  </figure>
</div>
<p>여기서는 app.use() 함수를 사용했는데요.</p>
<p>첫 번째 파라미터로 &ldquo;*&rdquo; 를 입력했습니다.</p>
<p>별표는 모든 경우의 수를 상정하는데요.</p>
<p>만약 app.get(&rdquo;/&rdquo;, ()=&gt;{} 코드처럼 &ldquo;/&rdquo; 경로를 지정하는 코드를 삭제한다면 &ldquo;localhost:4000&rdquo; 주소로도 notFoundErrorHandler가 처리하면서 에러 메시지를 보여줄 겁니다.</p>
<p>한번 테스트해 볼까요?</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// server health check
</span></span></span><span class="line"><span class="cl"><span class="c1">// app.get(&#34;/&#34;, (req, res) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="c1">//   res.status(200).json({
</span></span></span><span class="line"><span class="cl"><span class="c1">//     type: &#34;success&#34;,
</span></span></span><span class="line"><span class="cl"><span class="c1">//     message: &#34;Server is up and running&#34;,
</span></span></span><span class="line"><span class="cl"><span class="c1">//     data: null,
</span></span></span><span class="line"><span class="cl"><span class="c1">//   });
</span></span></span><span class="line"><span class="cl"><span class="c1">// });
</span></span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 app.get(&rdquo;/&rdquo;) 처리 부분을 주석처리하고 브라우저에서 &ldquo;localhost:4000&quot;으로 접속해 보겠습니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjPTPirfuWvmYf--VhLkF7g9YXwotGzQyLpRff3ojGoJbfoR7g78oRuwC5PMcqK5QZH-3fM4jhJP0WCi0oEd9AaJ2hWlexPGADiFjy3IdeX55ZDXQAEdtKLciDCCsubnqEzLJHlPa4VQy3hgaF2F7R0AxRtWjEmUnH6upOmnQvCrPekNMDXPm2GagoC"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림처럼 &ldquo;/&rdquo; 경로도 API endpoint 가 없다는 메시지가 나올 겁니다.</p>
<p>그리고 엔드포인트가 없는 경우 말고 서버 크래쉬나 에러가 났을 때는 어떻게 할까요?</p>
<p>바로 globalErrorHandler 미들웨어를 만들면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">globalErrorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="s1">&#39;Something went wrong&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">status</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>그리고 이 미들웨어를 src/server.js 에서 사용하게끔 아래와 같이 설정하면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// global error handler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">globalErrorHandler</span><span class="p">)</span></span></span></code></pre></div>
  </figure>
</div>
<p>즉, app.use() 함수는 미들웨어를 처리하는 함수라고 이해하시면 됩니다.</p>
<hr>
<h2 id="본격적인-엔드-포인트end-point-구성하기">본격적인 엔드 포인트(End Point) 구성하기</h2>
<p>그럼, 본격적인 API 백엔드 서버를 구성하기 전에 엔드 포인트에 대한 명확한 규칙을 머릿속에 구상해 놔야 하는데요.</p>
<p>이 서버의 용도가 API 서버라서 저는 아래와 같이 엔드 포인트를 구상할 예정입니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">;</span><span class="sb">`localhost:4000/api/auth/signup``localhost:4000/api/auth/login``localhost:4000/api/auth/logout``localhost:4000/api/auth/me`</span></span></span></code></pre></div>
  </figure>
</div>
<p>일단 auth 관련 부분이라 &ldquo;api/auth&quot;라고 지정할 예정입니다.</p>
<p>익스프레스 서버에서는 이런 걸 바로 라우트(route)라고 하는데요.</p>
<p>익스프레스 라우트는 중첩 라우트로도 구성도 가능합니다.</p>
<p>자 그럼 routes 구성을 위한 폴더를 만들어 볼까요?</p>
<p>src 폴더 밑에 routes 폴더를 만들고 그 밑에 index.js 파일과 auth.route.js 파일을 만듭시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/routes/auth.route.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">body</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-validator&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">signup</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../controllers/auth&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">signupValidation</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">).</span><span class="nx">not</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;First name must be required&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">not</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;Email address must be required&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">isEmail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;Incorrect email address&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">).</span><span class="nx">not</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;Password must be required&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/signup&#39;</span><span class="p">,</span> <span class="nx">signupValidation</span><span class="p">,</span> <span class="nx">signup</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span></span></span></code></pre></div>
  </figure>
</div>
<p>그리고 routes 폴더 밑의 index.js 파일입니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/routes/index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">authRoutes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./auth.route&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">registerRoutes</span> <span class="o">=</span> <span class="nx">app</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api/auth&#39;</span><span class="p">,</span> <span class="nx">authRoutes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>routes 폴더 밑의 index.js는 routes 폴더 밑에 있는 여러 routes를 총정리해서 exports해주는 요약 파일입니다.</p>
<p>앱이 커질수록 이 파일에서 엔드 포인트에 대한 경로가 일목요연하게 정리될 예정입니다.</p>
<p>마지막으로, server.js 파일에 아까 만들고 export했던 registerRoutes 함수를 이용해서 익스프레스 서버에 라우팅을 등록해 주면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/server.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">registerRoutes</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./routes&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// server health check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;Server is up and running&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// register routes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">registerRoutes</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// api route not found error handling
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">,</span> <span class="nx">notFoundErrorHandler</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span></span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 registerRoutes를 불러오는 require 문과 registerRoutes(app) 명령어를 위와 같이 적당한 위치에 놓으면 됩니다.</p>
<p>이제 auth.route.js 파일을 천천히 살펴볼까요?</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/auth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">signupValidation</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s2">&#34;firstName&#34;</span><span class="p">).</span><span class="nx">not</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&#34;First name must be required&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s2">&#34;email&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">not</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&#34;Email address must be required&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">isEmail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&#34;Incorrect email address&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">).</span><span class="nx">not</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&#34;Password must be required&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/signup&#34;</span><span class="p">,</span> <span class="nx">signupValidation</span><span class="p">,</span> <span class="nx">signup</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span></span></span></code></pre></div>
  </figure>
</div>
<p>처음 보는 위 코드가 보이는데요.</p>
<p>controllers 폴더 밑에 auth 폴더는 뭘까요?</p>
<p>그리고 signupValidation 변수는 뭘까요?</p>
<p>그리고 router.post(&quot;/signup&rdquo;, signupValidation, signup) 함수의 역할은 뭘까요?</p>
<p>역순으로 설명해 보자면 우리가 위에서 app.use(&quot;/api/auth&rdquo;)로 auth.route.js 파일을 사용하겠다고 등록했는데요.</p>
<p>그리고 auth.route.js 파일에서 router.post(&quot;/signup&rdquo;)이라고 router 객체에서 POST 방식을 지정한 겁니다.</p>
<p>그리고 &ldquo;/signup&quot;이라고 특정 엔드 포인트도 제공한 겁니다.</p>
<p>그래서 최종 엔드포인트는 &ldquo;localhost:4000/api/auth/signup&quot;이 되고, 그리고 이 경로의 POST 메소드에 대한 처리는 router.post(&quot;/signup&rdquo;, signupValidation, signup) 명령어에서처럼 보듯이 signupValidation 미들웨어를 거쳐 최종적으로 signup 함수를 실행하라는 명령입니다.</p>
<p>signupValidation 변수는 뭘까요?</p>
<p>일단은 express-validator 패키지를 쓰기 위한 변수인데요.</p>
<p>우리가 POST 메소드로 정보를 전달한다고 했는데 그 정보에서 우리가 필요한 게 있는지 없는지 서버 차원에서 체크하는 미들웨어입니다.</p>
<p>signupValidation는 배열인데요.</p>
<p>body(&ldquo;firstName&rdquo;)처럼 필요한 항목을 이용해서 데이터 유무를 처리하면 됩니다.</p>
<p>not() 메소드는 없으며 안된다는 얘기고 isEmpty() 메소도는 만약 데이터가 비었다면 그 뒤 withMessage 메소드를 출력하라는 뜻입니다.</p>
<p>대충 보시면 이해할 건데요.</p>
<p>이제 마지막으로 signup이라는 컨트롤러를 알아보겠습니다.</p>
<p>익스프레스 서버에서는 라우트 처리를 위한 함수를 컨트롤러라고 부릅니다.</p>
<p>그래서 signup 컨트롤러를 src/controllers/auth 폴더 밑에 따로 만들어 두는데요.</p>
<p>일단 src/controllers/auth 폴더를 만들고 signup.js 파일과 index.js 파일을 만듭시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/controllers/auth/index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">signup</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./signup&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>그리고 signup.js 파일입니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/controllers/auth/signup.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">validationResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-validator&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">hashPassword</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/password.util&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">db</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/db&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">generateRandomImage</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/generateImage&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">signup</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// return api fields level error validations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">next</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">status</span><span class="o">:</span> <span class="mi">422</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;User input error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">mapped</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="p">{</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">,</span> <span class="nx">gender</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//check duplicate email
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">emailExist</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">select</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">email</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">emailExist</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Email addresss already exists&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// hash password
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">password</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">hashPassword</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// create new user
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">firstName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">lastName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">gender</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">profileImage</span><span class="o">:</span> <span class="nx">generateRandomImage</span><span class="p">({</span> <span class="nx">str</span><span class="o">:</span> <span class="nx">email</span> <span class="p">}),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">coverImage</span><span class="o">:</span> <span class="nx">generateRandomImage</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">size</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">str</span><span class="o">:</span> <span class="nx">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="sb">`Account create for </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">user</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>여기서 중요한 건 유저 가입을 처리하기 위한 컨트롤러인 signup.js 파일입니다.</p>
<p>여기에서 DB를 직접 제어해서 사용자 정보를 DB에 직접 저장하는데요.</p>
<p>일단 utils 관련 함수가 보이네요.</p>
<p>src 폴더 밑에 utils 이라는 폴더를 만들고</p>
<p>아래처럼 4개의 파일을 만듭시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/utils/db.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">PrismaClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PrismaClient</span><span class="p">()</span></span></span></code></pre></div>
  </figure>
</div>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/utils/generateImage.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">randomHash</span> <span class="o">=</span> <span class="nx">str</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">generateRandomImage</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;identicon&#39;</span><span class="p">,</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">200</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">md5Hash</span> <span class="o">=</span> <span class="nx">randomHash</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="sb">`https://www.gravatar.com/avatar/</span><span class="si">${</span><span class="nx">md5Hash</span><span class="si">}</span><span class="sb">?d=</span><span class="si">${</span><span class="nx">type</span><span class="si">}</span><span class="sb">&amp;s=</span><span class="si">${</span><span class="nx">size</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">generateRandomImage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/utils/password.util.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bcrypt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// match plain password and hashed password
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">checkPassword</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">hashedPassword</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">matchPassword</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">hashedPassword</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">matchPassword</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// hash plain password into hashed password
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">hashPassword</span> <span class="o">=</span> <span class="kr">async</span> <span class="nx">password</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">hashed</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">hashed</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// /src/utils/token.util.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jsonwebtoken&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">JWT_SECRET</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../config/env.config&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// generate json web token from payload of userId
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">createJwtToken</span> <span class="o">=</span> <span class="nx">payload</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">JWT_SECRET</span><span class="p">,</span> <span class="p">{</span> <span class="nx">expiresIn</span><span class="o">:</span> <span class="s1">&#39;12h&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">token</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// verify incomming jwon web token and extract payload from it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">verifyJwtToken</span> <span class="o">=</span> <span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span> <span class="nx">userId</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">JWT_SECRET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">userId</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>각각 db.js 파일은 PRISMA 클라이언트 db 관련 파일이고,</p>
<p>generateImage 파일은 gravatar 사이트를 이용해서 사용자 프로파일이나 커버 이미지를 랜덤하게 디폴트값으로 만들어 주는 함수입니다.</p>
<p>요건 나중에 화장을 위해 만든 겁니다.</p>
<p>그리고 password와 token은 다들 아시다시피 해쉬된 패스워드와 JSONWebToken을 얻기 위한 함수입니다.</p>
<p>이 함수들은 유틸 함수들로 계속 사용할 함수라서 특별히 따로 만들어 놓은 겁니다.</p>
<p>이제 본격적으로 signup 컨트롤러를 살펴볼까요?</p>
<p>여기서 눈여겨봐야 할 express-validator 관련 함수인데요.</p>
<p>바로 const errors = validationResult(req); 함수입니다.</p>
<p>앞에서 signupValidation이라는 배열변수를 미들웨어로 전송한다고 했는데요.</p>
<p>바로 validationResult 함수에 의해 그 결과 값이 나옵니다.</p>
<p>여기서 errors 변수가 있다면 에러가 발생한 거고, 없다면 에러가 없다는 뜻입니다.</p>
<p>그리고, 사용자 가입을 위한 로직인데요.</p>
<p>req.body 부분에서 email, password, firstName 등 관련 정보를 let 변수로 지정하고,</p>
<p>그다음에 email이 기존에 가입되었는지 db.user.findUnique 함수로 체크합니다.</p>
<p>그리고 해당 email이 가입되어 있지 않다면 새로 가입해야 하는데요.</p>
<p>hashPassword함수로 유저가 입력한 패스워드를 암호화하고,</p>
<p>최종적으로 db.user.create 함수를 이용해서 저장합니다.</p>
<p>그리고 res.status(201).json() 함수를 이용해서 상태코드 201번으로 하고 성공했다는 데이터를 json 함수를 통해 전달하고 있습니다.</p>
<p>그럼 유저 가입 부분이 잘 되는지 테스트해 볼까요?</p>
<p>POSTMAN, Insomnia 같은 API 테스트 프로그램을 실행시켜서 아래 그림처럼 POST 메소드로 하고 관련 정보는 json 형식으로 전달합시다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjK_rb-yq4edaRO4_F2jtThtvL42sI-D6E_KoIThpEIDX2JD-VPyc4bICa73SaAJ5ClP18m-xWzWr2QVEOOzty2_vIas8yjXZFXxc9RzIz7XKAwUdmz2Jmr-mkZcMavTrugHAiVn8JhkruI1tuiIkNifGavpOFVdNkNLg9JuRPeVneeNJBZqp0s9VK0"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림처럼 유저 가입이 성공했는데요.</p>
<p>한번 email 부분과 firstName 부분의 정보를 빼고 테스트해 보십시오.</p>
<p>우리가 만든 express-validator에 의해 에러 메시지가 뜰 겁니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEiMaQoorgKLoTTzdHWeJgVmc_NHHwLomvq0TR7UR5cvKg9eZrbiHkrliGA6sYwPLmhFlZZ8UkYb5tF5tS2RY4fzwNGrgFuz42oYSLPftkfrygZtqgMbJ4mmX3ySdDe4Sep6vWbGQuer5iw-9cwyjSBgi-BuQMpZF6VRwIaUQDWdroJ4t2RwAG5cnwpn"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림은 email 부분을 이상하게 전송했을 때 에러 코드입니다.</p>
<p>그러면 DB 부분을 한번 살펴볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEgPtpbeKTq5usXjlABH_QpA4KLAXmYRSk62-I3-2b2W8C38vIpBEejvfHpw8LaXKtlsnncKyeMfLUGYKywOzcH3pvR4kzOY7CAkSHr8L4B79i1dLGlGT04S4meeD2baWN3ThEeJrP7eQiEXgZUEzz0524peKSuBKaCncwi7uh7GElEp0FQx5zax4e5U"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림과 같이 prisma studio 화면을 보시면 DB 저장도 잘 되고 있네요.</p>
<p>결론적으로 signup 컨트롤러는 정상적으로 작동되었네요.</p>
<hr>
<h2 id="login-컨트롤러-구현하기">login 컨트롤러 구현하기</h2>
<p>signup 다음에는 login 컨트롤러 구현인데요.</p>
<p>먼저, /src/routes/auth.route.js 파일을 아래와 같이 수정합시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">login</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/auth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">loginValidation</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s2">&#34;email&#34;</span><span class="p">).</span><span class="nx">not</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&#34;Email must be required&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">).</span><span class="nx">not</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&#34;Password must be required&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span></span></span></code></pre></div>
  </figure>
</div>
<p>다른 코드는 수정할 필요 없이 위와 같이 loginValidation 관련 자료만 추가하면 됩니다.</p>
<p>로그인할 때는 email과 password가 꼭 있어야 한다는 거죠.</p>
<p>이제 login 컨트롤러를 만들어야 하는데요.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/controllers/auth/login.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">db</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/db&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">validationResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-validator&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">checkPassword</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/password.util&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">createJwtToken</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/token.util&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">NODE_ENV</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../config/env.config&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// return api fields validation errors
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">next</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">status</span><span class="o">:</span> <span class="mi">422</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;User input error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">mapped</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//verify email
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Incorrect email address&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// verify password
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">matchPassword</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">checkPassword</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">matchPassword</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Incorrect password&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// create token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">createJwtToken</span><span class="p">({</span> <span class="nx">userId</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// set token to user frontend cookies
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cookie</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">httpOnly</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sameSite</span><span class="o">:</span> <span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;production&#39;</span> <span class="o">?</span> <span class="s1">&#39;none&#39;</span> <span class="o">:</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxAge</span><span class="o">:</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">secure</span><span class="o">:</span> <span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;production&#39;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// const { name, version, layout, description, ua, os } = platform;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">currentUser</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;ACTIVE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">currentUser</span><span class="p">.</span><span class="nx">password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;You have logged in successfully&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">user</span><span class="o">:</span> <span class="nx">currentUser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>로그인 컨트롤러는 정말 어려워 보이는데요.</p>
<p>하나하나 천천히 살펴봅시다.</p>
<p>먼저, validationResult로 express-validator에 대한 처리를 해주고요.</p>
<p>req.body 에서 로그인을 하기 위한 정보인 email과 password 값을 얻습니다.</p>
<p>그리고 email을 찾아보는데요.</p>
<p>만약 없으면 에러코드를 리턴하고,</p>
<p>email이 있으면 이제 password 값을 비교해야 합니다.</p>
<p>password 비교는 우리가 아까 utils 폴더 밑에 만들었던 password 관련 함수를 이용했습니다.</p>
<p>패스워드가 맞는다면 로그인해야 하는데요.</p>
<p>로그인했다는 뜻이 뭘까요?</p>
<p>별거 없습니다.</p>
<p>쿠키에 유저 정보를 저장하고 만약 쿠키에 유저 정보가 있다면 로그인, 없다면 로그인 안 했다는 뜻입니다.</p>
<p>그런데 유저 로그인 정보는 중요하고 민감한 정보이기 때문에 JSONWebToken으로 처리하는데요.</p>
<p>그래서 createJwtToken 함수로 userId를 이용해서 토큰을 만들어 줍니다.</p>
<p>그리고 이 토큰값을 token=토큰값 형식으로 쿠키를 저장하는데요.</p>
<p>그게 바로 Response(응답) 객체인 res.set() 함수로 처리합니다.</p>
<p>쿠키 저장하는 일반적인 방식은 아래와 같은데요.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">res</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;cookieName=cookieValue; Path=/; HttpOnly&#39;</span><span class="p">)</span></span></span></code></pre></div>
  </figure>
</div>
<p>위 res.set() 함수에서 두 번째 값이 텍스트 파일입니다.</p>
<p>cookieName=cookieValue 형식으로 스트링 형식으로 저장하는데요</p>
<p>cookie 패키지가 이걸 쉽게 해 줄 수 있습니다.</p>
<p>그래서 아래와 같이 cookie.serialize 함수를 이용하면 쉽게 res.set() 함수의 두 번째 파라미터값을 얻을 수 있습니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">cookie</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="s2">&#34;token&#34;</span><span class="p">,</span> <span class="nx">token</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">httpOnly</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sameSite</span><span class="o">:</span> <span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s2">&#34;production&#34;</span> <span class="o">?</span> <span class="s2">&#34;none&#34;</span> <span class="o">:</span> <span class="s2">&#34;strict&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxAge</span><span class="o">:</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">path</span><span class="o">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">secure</span><span class="o">:</span> <span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s2">&#34;production&#34;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="sb">```</span></span></span></code></pre></div>
  </figure>
</div>
<p>express와 함께 많이 쓰이는 cookie 패키지에 대한 간단한 설명입니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">cookie</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></span></span></code></pre></div>
  </figure>
</div>
<p>사용법은 위와 같고요.</p>
<p>&ldquo;name&quot;이 바로 쿠키 이름이고 &ldquo;value&quot;가 쿠키값입니다.</p>
<p>우리 입장에서 보면 &ldquo;name&quot;이 &ldquo;token&quot;이 되고 &ldquo;value&quot;가 createJwtToken() 함수로 만든 토큰값이 되는 거죠.</p>
<p>그리고 option부분인데요.</p>
<p>domain: 도메인 부분입니다. 이건 별로 안 쓰는데요. 디폴트값은 현재 도메인입니다.</p>
<p>path: 현재 경로입니다. 보통 &ldquo;/&ldquo;을 많이 넣습니다.</p>
<p>expires: 쿠키의 종료 시점을 정할 수 있는데요. Date 객체입니다. 이게 지정되어 있지 않으면 기본적으로 세션 쿠키가 됩니다. 세션 쿠키는 브라우저가 종료되면 없어지는 쿠키죠.</p>
<p>maxAge: 쿠키의 존재 기간입니다. 단위는 초입니다. 만약 expires 옵션과 maxAge 옵션이 같이 있다면 expires 옵션이 우선합니다.</p>
<p>secure: 만약 true라면 쿠키는 https 연결을 통해서만 전달 가능하다는 뜻입니다.</p>
<p>httpOnly: 만약 true라면 쿠키는 자바스크립트로는 액세스가 안 되고 무조건 HTTP 커넥션으로만 접근할 수 있다는 뜻입니다.</p>
<p>잠깐 cookie 패키지 사용법에 대해 알아봤는데요.</p>
<p>다시 login 컨트롤러로 돌아가 보면,</p>
<p>이제 쿠키도 세팅했고, db에 user 부분을 update하는데요.</p>
<p>user 모델의 status 부분을 &ldquo;ACTIVE&quot;라고 업데이트했습니다.</p>
<p>현재 사용자가 로그인했다는 뜻이죠.</p>
<p>이것도 나중에 앱 확장을 위해 미리 넣어둔 겁니다.</p>
<p>그리고 보안을 위해 currentUser의 password부분을 메모리에서 삭제하고 최종적으로 201 상태코드로 json 결과 값을 response로 넘기게 됩니다.</p>
<p>이제 테스트해 볼까요?</p>
<p>테스트하기 전에 /src/controllers/auth/index.js 파일에서 login 항목을 export 해야 합니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/controllers/auth/index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">signup</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./signup&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">login</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./login&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">login</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>이제 테스트 결과를 볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEijLZFKhyQqpqH6oT4nmD5ziuA8Z73l_1y9rKTvbvqPn8ekaXsdSPacHbZ8B2Ra434FRN-LINvDCA-n5DqKJyZroeaQsGkR8_L1Hl-kjr6cOLkPEeV0bTDqjL2dsNs0UJf1P_QU8ssM7XCm6OWox_VCFXsWqJm3Z-LSvCp5GxgjoIAKNzE7EhtmRUs9"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림과 같이 login이 성공했다고 나옵니다.</p>
<hr>
<h2 id="login-상태를-확인하는-엔드-포인트-만들기">login 상태를 확인하는 엔드 포인트 만들기</h2>
<p>한번 로그인했다면 보통 현재 로그인된 사용자 정보를 알려주는 엔드 포인트를 만드는 게 좋은데요.</p>
<p>그래서 &ldquo;localhost:4000/api/auth/me&quot;라는 엔드 포인트를 만들어 보겠습니다.</p>
<p>먼저, 라우트를 수정해야 하는데요.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">checkAuth</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../middlewares/auth.middleware&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">signup</span><span class="p">,</span> <span class="nx">login</span><span class="p">,</span> <span class="nx">fetchCurrentUser</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/auth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;/me&#34;</span><span class="p">,</span> <span class="nx">checkAuth</span><span class="p">,</span> <span class="nx">fetchCurrentUser</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span></span></span></code></pre></div>
  </figure>
</div>
<p>위 코드를 보니까 컨트롤러는 GET 메소드를 이용하고, 또 fetchCurrentUser라는 걸 만들어야 하고 checkAuth라는 미들웨어를 만들어야 합니다.</p>
<p>먼저, auth.middleware입니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/middleware/auth.middleware.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">db</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../utils/db&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">verifyJwtToken</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../utils/token.util&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// extract json web token from cookies
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">token</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="mi">403</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;JWT token is missing&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//verify jwo token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">userId</span> <span class="o">=</span> <span class="nx">verifyJwtToken</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="mi">403</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;JWT token is not valid&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// find user from payload userId
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="nx">userId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="mi">404</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;User does not exists&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// store user data in response local object, it is valid for one req-res cycle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>이 미들웨어가 바로 checkAuth라는 이름으로 쓰이는데요.</p>
<p>위 미들웨어는 토큰에서 userId 값을 뽑아내고 그걸 이용해서 user 정보를 알아냅니다.</p>
<p>그리고 user 정보를 res.locals.user라는 Response 객체에 추가하는데요.</p>
<p>Response에 있는 locals라는 변수에, 클라이언트에서 볼 수 있는 정보를 잠깐 저장할 수 있습니다.</p>
<p>locals에 저장되는 변수는 Request와 Response가 한 번의 사이클 동안만 저장할 수 있습니다.</p>
<p>만약 다른 Request가 발생했다면 locals 정보가 사라지니까요?</p>
<p>잠깐만 클라이언트에서 확인할 용도로만 사용해야 합니다.</p>
<p>그러고 나서, fetchCurrentUser 컨트롤러를 만들어야 하는데요.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/controllers/auth/fetchCurrentUser.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">db</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/db&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">fetchCurrentUser</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//get data already store in response local objects
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">currentUserId</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">currentUser</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="nx">currentUserId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">currentUser</span><span class="p">.</span><span class="nx">password</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Fetch current user&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">user</span><span class="o">:</span> <span class="nx">currentUser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>fetchCurrentUser 컨트롤러도 어려운 건 없고요.</p>
<p>아까 Request쪽 미들웨어인 checkAuth에서 클라이언트로 넘기 Response.locals 값에 있는 user 정보를 이용해서 다시 DB에서 현재 로그인된 사용자의 정보를 얻는 겁니다.</p>
<p>마지막으로 controllers/auth/index.js 파일을 아래와 같이 바꿔줍니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/controllers/auth/index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">signup</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./signup&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">login</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./login&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">fetchCurrentUser</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./fetchCurrentUser&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">login</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fetchCurrentUser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>이제 테스트해 볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEgC7_riA7-8LbT7q7SWXgZew5-fHiMJIe9PafCFDtRoY4pCZubxJRgprRooXLdDh9peui5uaQQE9cSxjA0ATLShV53Wj5FQKa6L183XuUhryqupx0w-E7BCU8bssraFw893b7W691wcgvzr6uz7Q4KJvIGr7Lh66h3pfIqPRtX26Ze55fb7eVi-vWCW"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림처럼 GET 메소드라 전달할 정보가 없이 그냥 경로 창에 &ldquo;localhost:4000/api/auth/me&quot;라고 치니까 응답 창에 성공적이라고 나오면서 현재 사용자 정보가 나옵니다.</p>
<p>결과는 대성공이네요.</p>
<hr>
<h2 id="마지막으로-logout-컨트롤러-만들기">마지막으로 logout 컨트롤러 만들기</h2>
<p>이제 로그인했으니까 로그아웃하는 컨트롤러를 만들어 볼까요?</p>
<p>로그아웃은 쿠키에서 토큰값만 없애면 됩니다.</p>
<p>왜냐하면 우리가 로그인됐다는 정보를 쿠키에서 토큰값을 얻어서 그 토큰값에서 userId 값을 얻었기 때문이죠.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/routes/auth.route.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">login</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fetchCurrentUser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">logout</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/auth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s2">&#34;/logout&#34;</span><span class="p">,</span> <span class="nx">checkAuth</span><span class="p">,</span> <span class="nx">logout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span></span></span></code></pre></div>
  </figure>
</div>
<p>위 코드를 보면 컨트롤러로는 logout 컨트롤러가 보이고, 라우팅은 PATCH 메소드로 &ldquo;/logout&rdquo; 주소를 사용했습니다.</p>
<p>logout 컨트롤러도 checkAuth라는 미들웨어가 필요한데요.</p>
<p>왜냐하면 현재 로그인된 사용자만 로그아웃을 할 수 있기 때문입니다.</p>
<p>이제 컨트롤러를 만들어 볼까요?</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/controllers/auth/logout.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">db</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../utils/db&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">NODE_ENV</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../config/env.config&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">logout</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">userId</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="nx">userId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;LOGOUT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cookie</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">httpOnly</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sameSite</span><span class="o">:</span> <span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;production&#39;</span> <span class="o">?</span> <span class="s1">&#39;none&#39;</span> <span class="o">:</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">expires</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">secure</span><span class="o">:</span> <span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;production&#39;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;You have logout successfully&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>로그아웃 로직은 간단한데요.</p>
<p>현재 유저의 상태(status)를 DB에서 &ldquo;LOGOUT&quot;으로 바꾸고,</p>
<p>그리고 다시 한번 res.set() 함수를 이용해 쿠키값을 바꿔 줍니다.</p>
<p>위 코드에서는 &ldquo;token&rdquo; 다음에 &quot;&rdquo; 빈문자열이 왔죠.</p>
<p>즉, &ldquo;token&quot;값을 지운다는 뜻입니다.</p>
<p>토큰값이 없으면 현재 로그인된 userId 값을 얻을 수 없기 때문에 로그아웃 됐다는 뜻이 되기 때문이죠.</p>
<p>다시 controllers/auth/index.js 파일에서 아래 컨트롤러를 추가합시다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">signup</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./signup&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">login</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./login&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">fetchCurrentUser</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./fetchCurrentUser&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">logout</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./logout&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">signup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">login</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fetchCurrentUser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">logout</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>이제 테스트해 볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjuyF4S9-KYRRum7eS8pgpQnwNQBC8Kxb1fjW5Gv8uG3czTdpCFpGTAOtrq_Ewle0ZFyX98v5J3S3Xqu61v9JS0uK8NTbuLjj_eZjRKLiKm_xzHb38ztSvLuM8giEQqm6gwdQGnR49VOdwiRyZCvLIBMA2giAG2lRZbDwVQl6UUxfr4KEz3qPuvCjfJ"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림을 보시면 로그아웃 기능도 정상적으로 작동되네요.</p>
<p>지금까지 Nodejs Express 백엔드 API 서버를 구축해 봤는데요.</p>
<p>그 첫 번째인 Auth 관련 강좌였습니다.</p>
<p>다음에는 좀 더 나은 기능으로 찾아뵙도록 하겠습니다.</p>
<p>src 폴더 밑의 tree 값입니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  nodejs-api-test tree --du -h src
</span></span><span class="line"><span class="cl"><span class="o">[</span> 11K<span class="o">]</span>  src
</span></span><span class="line"><span class="cl">├── <span class="o">[</span> 403<span class="o">]</span>  config
</span></span><span class="line"><span class="cl">│   └── <span class="o">[</span> 307<span class="o">]</span>  env.config.js
</span></span><span class="line"><span class="cl">├── <span class="o">[</span>5.2K<span class="o">]</span>  controllers
</span></span><span class="line"><span class="cl">│   └── <span class="o">[</span>5.1K<span class="o">]</span>  auth
</span></span><span class="line"><span class="cl">│       ├── <span class="o">[</span> 547<span class="o">]</span>  fetchCurrentUser.js
</span></span><span class="line"><span class="cl">│       ├── <span class="o">[</span> 249<span class="o">]</span>  index.js
</span></span><span class="line"><span class="cl">│       ├── <span class="o">[</span>1.9K<span class="o">]</span>  login.js
</span></span><span class="line"><span class="cl">│       ├── <span class="o">[</span> 814<span class="o">]</span>  logout.js
</span></span><span class="line"><span class="cl">│       └── <span class="o">[</span>1.5K<span class="o">]</span>  signup.js
</span></span><span class="line"><span class="cl">├── <span class="o">[</span>1.5K<span class="o">]</span>  middlewares
</span></span><span class="line"><span class="cl">│   ├── <span class="o">[</span> 961<span class="o">]</span>  auth.middleware.js
</span></span><span class="line"><span class="cl">│   └── <span class="o">[</span> 442<span class="o">]</span>  error.middleware.js
</span></span><span class="line"><span class="cl">├── <span class="o">[</span>1.2K<span class="o">]</span>  routes
</span></span><span class="line"><span class="cl">│   ├── <span class="o">[</span>1007<span class="o">]</span>  auth.route.js
</span></span><span class="line"><span class="cl">│   └── <span class="o">[</span> 120<span class="o">]</span>  index.js
</span></span><span class="line"><span class="cl">├── <span class="o">[</span>1.3K<span class="o">]</span>  server.js
</span></span><span class="line"><span class="cl">└── <span class="o">[</span>1.5K<span class="o">]</span>  utils
</span></span><span class="line"><span class="cl">    ├── <span class="o">[</span>  85<span class="o">]</span>  db.js
</span></span><span class="line"><span class="cl">    ├── <span class="o">[</span> 363<span class="o">]</span>  generateImage.js
</span></span><span class="line"><span class="cl">    ├── <span class="o">[</span> 399<span class="o">]</span>  password.util.js
</span></span><span class="line"><span class="cl">    └── <span class="o">[</span> 500<span class="o">]</span>  token.util.js
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  25K used in <span class="m">7</span> directories, <span class="m">15</span> files</span></span></code></pre></div>
  </figure>
</div>
<p>그럼.</p>

      <div class="tag-list-single">
        <a class="btn btn-light" href="/tags/nodejs/" role="button">nodejs</a>
        <a class="btn btn-light" href="/tags/express/" role="button">express</a>
        <a class="btn btn-light" href="/tags/expressjs/" role="button">expressjs</a>
        <a class="btn btn-light" href="/tags/prisma/" role="button">prisma</a>
        <a class="btn btn-light" href="/tags/api/" role="button">api</a>
        <a class="btn btn-light" href="/tags/auth/" role="button">auth</a>
        <a class="btn btn-light" href="/tags/tutorial/" role="button">tutorial</a>
        </div>
      
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-format="autorelaxed"
          data-ad-client="ca-pub-7748316956330968"
          data-ad-slot="4495825428"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</article>

      
      </div>
    </div>
    
    
<div class="bg-light">
    <section class="section section-related container">
      <div class="row justify-content-center">
        <div class="col-md-12 col-lg-12">
          <h2 class="section-title text-center">Related posts</h2>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-lg-12">
          <div class="card">
              <div class="card-body">
                <article>
                  <h2 class="h3"><a class="stretched-link text-body" href="/blog/2023-02-20-nodejs-express-backend-api-tutorial-2-post-comment/">Nodejs Express Backend API 강좌 2편 - Post, Comment</a></h2>
                  <p>2편. Post, Comment 추가하기 - Nodejs Express 프레임워크로 만드는 서버 강좌</p>
                  <p>
  <small>February 20, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>9&nbsp;minutes</span></small>
</p>
</article>
              </div>
            </div>
          <div class="card">
              <div class="card-body">
                <article>
                  <h2 class="h3"><a class="stretched-link text-body" href="/blog/2022-12-19-expressjs-nodejs-handbook-2022/">Expressjs와 Nodejs로 만드는 백엔드 완전 정복 설명서</a></h2>
                  <p>Expressjs와 Nodejs로 만드는 백엔드 완전 정복 설명서</p>
                  <p>
  <small>December 19, 2022<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>14&nbsp;minutes</span></small>
</p>
</article>
              </div>
            </div>
          <div class="card">
              <div class="card-body">
                <article>
                  <h2 class="h3"><a class="stretched-link text-body" href="/blog/2023-11-09-astrojs-howto-supabase-authentication-with-ssr/">astrojs 강좌 9편. astrojs와 supabase로 유저 로그인 구현</a></h2>
                  <p>Supabase의 Authentication을 이용해서 AstroJS에서 유저 로그인 구현하기</p>
                  <p>
  <small>November 9, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>11&nbsp;minutes</span></small>
</p>
</article>
              </div>
            </div>
          </div>
      </div>
    </section>
    <script src="https://utteranc.es/client.js"
      repo="cpro95/utterances_mycodings_fly_dev"
      issue-term="pathname"
      theme="github-light"
      label="blog-comment"
      crossorigin="anonymous"
    async>
    </script>
  </div>
  
    <footer class="footer text-muted">
  <div class="container-lg">
    <div class="row">
      <div class="col-lg-8 text-center text-lg-start">
        <ul class="list-inline">
          <li class="list-inline-item"><a class="text-muted" href="/about/">about</a></li>
        </ul>
      </div>
      <div class="col-lg-8 text-center text-lg-end">
        <ul class="list-inline">
          <li class="list-inline-item">Copyright (c) All Right Reserved.</li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    

<script async
  src="/js/app.19b73e0182301dd61c9211c2f6890104740e2eb9eb12fe4ba8d4f31435b22ed6.js"
  integrity="sha256-Gbc&#43;AYIwHdYckhHC9okBBHQOLrnrEv5LqNTzFDWyLtY=">
</script>





<script async
  src="/js/flexsearch.5dd6433c29c3e043627f046054aed58ff3790f58fdb8423f45125bbafdcad335.js"
  integrity="sha256-XdZDPCnD4ENifwRgVK7Vj/N5D1j9uEI/RRJbuv3K0zU=">
</script>
<script async
  src="/js/search-modal.96e662d8f691fe25c859a3437074b485f2d7bed0bca612725028c6cf4322e2f2.js"
  integrity="sha256-luZi2PaR/iXIWaNDcHS0hfLXvtC8phJyUCjGz0Mi4vI=">
</script>

    <div class="d-inline-flex fixed-bottom-right pb-4 pe-4">
  <button id="toTop" type="button" class="btn btn-primary rounded-circle ms-auto p-2"><span class="visually-hidden">Top</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 15l6 -6l6 6"></path></svg></button>
</div>

    
  </body>
</html>
