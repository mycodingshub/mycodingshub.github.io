<!doctype html>
<html lang="ko" data-bs-theme="auto">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="preload" href="https://mycodingshub.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://mycodingshub.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://mycodingshub.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2" as="font" type="font/woff2" crossorigin>
<script 
  src="/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js"
  integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg=">
</script>


<link rel="stylesheet" href="/main.86b7305f5a96b7dd3a46fa6277d87b125af3bf13f48c4cfcc269be84fa9e8fb75375d45a5fe9056ce9190644b7a6e5f13f917f12d853ed38bb76d8856898f755.css" integrity="sha512-hrcwX1qWt906Rvpid9h7ElrzvxP0jEz8wmm+hPqej7dTddRaX+kFbOkZBkS3puXxP5F/EthT7Ti7dtiFaJj3VQ==" crossorigin="anonymous">

<noscript><style>img.lazyload { display: none; }</style></noscript><title>풀스택 강의 1편. Cloudflare Pages &#43; Workers &#43; D1 &#43; React로 풀스택 개발하기</title>
<meta name="description" content="Cloudflare 무료 서비스로 풀스택 웹 앱 만들기" />
<link rel="canonical" href="https://mycodingshub.github.io/blog/2023-12-06-introduction-cloudflare-pages-workers-d-1-react-full-stack/" />
<meta name="robots" content="index, follow" />

<meta property="og:type" content="article" />
<meta property="og:title" content="풀스택 강의 1편. Cloudflare Pages &#43; Workers &#43; D1 &#43; React로 풀스택 개발하기" />
<meta property="og:description" content="Cloudflare 무료 서비스로 풀스택 웹 앱 만들기" />
<meta property="og:url" content="https://mycodingshub.github.io/blog/2023-12-06-introduction-cloudflare-pages-workers-d-1-react-full-stack/" />
<meta property="og:site_name" content="Home" />
<meta property="og:image" content="https://mycodingshub.github.io/cover.png" />
<meta property="og:locale" content="en" />
<meta property="article:published_time" content="2023-12-06T11:55:18Z" />
<meta property="article:modified_time" content="2023-12-06T11:55:18Z" />
<meta property="article:tag" content="cloudflare" />
<meta property="article:tag" content="pages" />
<meta property="article:tag" content="d1" />
<meta property="article:tag" content="workers" />
<meta property="article:tag" content="react" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="풀스택 강의 1편. Cloudflare Pages &#43; Workers &#43; D1 &#43; React로 풀스택 개발하기" />
<meta name="twitter:description" content="Cloudflare 무료 서비스로 풀스택 웹 앱 만들기" />
<meta name="twitter:image" content="https://mycodingshub.github.io/cover.png" />

<meta name="author" content="cpro95@gmail.com" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "\"풀스택 강의 1편. Cloudflare Pages + Workers + D1 + React로 풀스택 개발하기\"",
  "description": "\"Cloudflare 무료 서비스로 풀스택 웹 앱 만들기\"",
  "datePublished": "\"2023-12-06T11:55:18Z\"",
  "dateModified": "\"2023-12-06T11:55:18Z\"",
  "author": {
    "@type": "Person",
    "name": "\"cpro95@gmail.com\""
  },
  "image": "\"https://mycodingshub.github.io/cover.png\"",
  "url": "\"https://mycodingshub.github.io/blog/2023-12-06-introduction-cloudflare-pages-workers-d-1-react-full-stack/\"",
  "publisher": {
    "@type": "Organization",
    "name": "\"Home\""
  }
}
</script>




<script async src="https://www.googletagmanager.com/gtag/js?id=G-C7SBETWEJ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C7SBETWEJ0');
</script>


<script
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7748316956330968"
  crossOrigin="anonymous"
></script>


</head>

  
  <body class="single section blog" data-bs-spy="scroll" data-bs-target="#toc" data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll="true" tabindex="0">
    <div class="sticky-top">
<header class="navbar navbar-expand-sm">
  <div class="container-lg">
  <div class="d-flex flex-grow-1 justify-content-between">
    <div class="d-flex flex-row navbar-nav justify-content-between align-items-start gap-2">
    
    <a class="nav-link fw-bold fs-4" href="/">Home</a>

    
    
            <a class="nav-link fs-4  active" href="https://mycodingshub.github.io/blog/" aria-current="true">Blog</a>
          
        
            <a class="nav-link fs-4 " href="https://mycodingshub.github.io/life/">Life</a>
          
        
    </div>
    <div class="d-flex flex-row justify-content-between align-items-center">
      
      
      <button type="button" id="searchToggleMobile" class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
      </button>
      
      
      <button type="button" id="searchToggleDesktop" class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
      </button>
      
      <button id="buttonColorMode" class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type="button" aria-label="Toggle theme">
        <svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
        </svg>
        <svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0m-5 0h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path>
        </svg>
      </button>
      </div>
        
        
        
        
        </div>
    </div>

    
    </div>
</header>
</div>

<div class="modal" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5 visually-hidden" id="searchModalLabel">Search</h1>
        <button type="button" class="btn-close visually-hidden" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="search-input flex-grow-1 d-none">
          <form id="search-form" class="search-form" action="#" method="post" accept-charset="UTF-8" role="search">
            <label for="query" class="visually-hidden">Search</label>
            <div class="d-flex">
              <input type="search" id="query" name="query" class="search-text form-control form-control-lg" placeholder="Search" aria-label="Search" maxlength="128" autocomplete="off">
              <button type="button" class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss="modal" aria-label="Close">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-body">
        <p class="search-loading status message d-none mt-3 text-center">Loading search index…</p>
        <p class="search-no-recent message d-none mt-3 text-center">No recent searches</p>
        <p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class="query-no-results">Query here</span></strong>"</p>
        <div id="searchResults" class="search-results"></div>
        <template>
          <article class="search-result list-view">
            <div class="card my-3">
              <div class="card-body">
                <header>
                  <h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href="#">Title here</a></h2>
                  <div class="submitted d-none"><time class="created-date">Date here</time></div>
                </header>
                <div class="content">Summary here</div>
              </div>
            </div>
          </article>
        </template>
      </div>
      <div class="modal-footer">
        <ul class="list-inline me-auto d-none d-md-block">
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4M7 11.53088l-3-3 3-3"></path></g></svg></kbd><span class="DocSearch-Label">to select</span></li>
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8M10.5 8.5l-3 3-3-3"></path></g></svg></kbd><kbd class="me-2"><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8M10.5 6.5l-3-3-3 3"></path></g></svg></kbd><span class="DocSearch-Label">to navigate</span></li>
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956"></path></g></svg></kbd><span class="DocSearch-Label">to close</span></li>
        </ul>
        <p class="d-md-none">Search by <a class="text-decoration-none" href="https://github.com/nextapps-de/flexsearch">FlexSearch</a></p>
      </div>
    </div>
  </div>
</div>


    <div class="wrap container-lg" role="document">
      <div class="content">
      
        
<article>
  <div class="row justify-content-center">
    <div class="col-md-12 col-lg-12">
      
      <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-7748316956330968"
        data-ad-slot="2971373181"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      <div class="blog-header">
        <h1>풀스택 강의 1편. Cloudflare Pages &#43; Workers &#43; D1 &#43; React로 풀스택 개발하기</h1>
        <p>
  <small>December 6, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>14&nbsp;minutes</span></small>
</p>

      </div>
    </div>
      <div class="col-md-12 col-lg-12">
      
      <p>안녕하세요?</p>
<p>오늘은 지금까지 미뤄왔던 Cloudflare 서비스를 이용한 풀스택 개발하기에 대해 알아보겠습니다.</p>
<p>Cloudflare는 아마존 AWS에 맞먹는 클라우드 서비스를 제공해 주는데요.</p>
<p>몇몇 기능들은 아직 베타 단계이지만 저도 지금 잘 쓰고 있는 Pages를 비롯해서 몇몇 서비스들을 공짜로 사용할 수 있습니다.</p>
<p>오늘 우리가 살펴볼 Cloudflare의 서비스는 웹 페이지 호스팅을 위한 Pages란 서비스와 함께, 백엔드를 위한 Workers와 함께 DB 구현을 위한 D1 서비스를 사용할 겁니다.</p>
<p>그리고 프론트엔드는 당연히 React가 되겠죠.</p>
<p>일단 Cloudflare 계정이 있다고 가정하고 진행하겠습니다.</p>
<p>전체 강의 리스트입니다.</p>
<ol>
<li>
<p><a href="https://mycodingshub.github.io/blog/2023-12-06-introduction-cloudflare-pages-workers-d-1-react-full-stack">풀스택 강의 1편. Cloudflare Pages + Workers + D1 + React로 풀스택 개발하기</a></p>
</li>
<li>
<p><a href="https://mycodingshub.github.io/blog/2023-12-09-fullstack-cloudflare-pages-workers-d-1-react-part-2">풀스택 강의 2편. Cloudflare Pages 안에서 Workers를 이용한 D1 DB 제어하는 API 만들기</a></p>
</li>
<li>
<p><a href="https://mycodingshub.github.io/blog/2023-12-09-fullstack-astrojs-cloudflare-pages-d-1-drizzle-orm">풀스택 강의 3편. AstroJS와 Cloudflare Pages, D1, Drizzle ORM으로 개발하기</a></p>
</li>
<li>
<p><a href="https://mycodingshub.github.io/blog/2023-12-10-fullstack-remix-cloudflare-pages-d-1-db-drizzle-orm">풀스택 강의 4편. Remix + Cloudflare Pages + D1 DB + Drizzle ORM</a></p>
</li>
<li>
<p><a href="https://mycodingshub.github.io/blog/2023-12-30-fullstack-tutorial-nextjs-cloudflare-with-d-1-db">풀스택 강의 5편. Next.js 서버 렌더링을 이용하여 Cloudflare Pages로 배포하기(D1 DB, Drizzle ORM)</a></p>
</li>
<li>
<p><a href="https://mycodingshub.github.io/blog/2024-02-25-fullstack-tutorial-remix-cloudflare-with-kv-and-github-server">풀스택 강의 6편. Remix로 Github 저장소를 DB로 이용해서 KV와 함께 Cloudflare에 배포하기</a></p>
</li>
<li>
<p><a href="https://mycodingshub.github.io/blog/2024-03-03-fullstack-tutorial-transform-vite-react-app-with-hono-framework">풀스택 강의 7편. Vite React 템플릿을 Hono를 이용하여 풀스택 앱으로 개조하기</a></p>
</li>
</ol>
<hr>
<p>** 목 차 **</p>
<ol>
<li>
<p><a href="#1-vite%eb%a1%9c-react-%ed%85%9c%ed%94%8c%eb%a6%bf-%ec%9e%91%ec%84%b1">Vite로 React 템플릿 작성</a></p>
</li>
<li>
<p><a href="#2-pages%ec%97%90-%ec%a0%95%ec%a0%81-%ec%82%ac%ec%9d%b4%ed%8a%b8%eb%a1%9c-%ec%98%ac%eb%a6%ac%ea%b8%b0">Pages에 정적 사이트로 올리기</a></p>
</li>
<li>
<p><a href="#3-workers-%ec%9d%b4%ec%9a%a9%ed%95%98%ec%97%ac-%eb%b0%b1%ec%97%94%eb%93%9c-%eb%a1%9c%ec%a7%81-%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0">Workers 이용하여 백엔드 로직 구현하기</a></p>
</li>
<li>
<p><a href="#4-d1-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%b2%a0%ec%9d%b4%ec%8a%a4-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0">D1 데이터베이스 사용하기</a></p>
</li>
</ol>
<hr>
<h2 id="1-vite로-react-템플릿-작성">1. Vite로 React 템플릿 작성</h2>
<p>Cloudflare는 wrangler라는 커맨드라인 명령어를 지원하는데요.</p>
<p>이 앱은 조금 더 범용이라, 우리가 오늘 구현할 React 앱 구현에 있어 아주 불편합니다.</p>
<p>그래서 처음부터 Vite로 React 앱을 작성한 다음 하나하나 추가하면서 Cloudflare의 Pages와 Workers 및 D1 서비스를 이용하도록 하겠습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  blog&gt; npm create vite@latest
</span></span><span class="line"><span class="cl">✔ Project name: … cloudflare-pages-d1-stack-example
</span></span><span class="line"><span class="cl">✔ Select a framework: › React
</span></span><span class="line"><span class="cl">✔ Select a variant: › TypeScript
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Scaffolding project in /Users/cpro95/Codings/Javascript/blog/cloudflare-pages-d1-stack-example...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Done. Now run:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> cloudflare-pages-d1-stack-example
</span></span><span class="line"><span class="cl">  npm install
</span></span><span class="line"><span class="cl">  npm run dev</span></span></code></pre></div>
  </figure>
</div>
<p>CSS를 위한 TailwindCSS 설치도 이어서 하겠습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install -D tailwindcss postcss autoprefixer
</span></span><span class="line"><span class="cl">npx tailwindcss init -p</span></span></code></pre></div>
  </figure>
</div>
<p>그리고 tailwind.config.js 파일도 아래와 같이 바꾸시면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/** @type {import(&#39;tailwindcss&#39;).Config} */</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">content</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./src/**/*.{js,ts,jsx,tsx}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">theme</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extend</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>그리고 Tailwind 디렉티브를 index.css 파일에 추가하면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="err">@</span><span class="nx">tailwind</span> <span class="nx">base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="nx">tailwind</span> <span class="nx">components</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="nx">tailwind</span> <span class="nx">utilities</span><span class="p">;</span></span></span></code></pre></div>
  </figure>
</div>
<p>이제 모든 준비가 끝났는데요.</p>
<hr>
<h2 id="2-pages에-정적-사이트로-올리기">2. Pages에 정적 사이트로 올리기</h2>
<p>Cloudflare Pages는 무료 정적 사이트 호스팅 서비스인데요.</p>
<p>도메인은 ***.pages.dev 라는 이름입니다.</p>
<p>제가 예전에 만들었던 <a href="https://mylotto.pages.dev">mylotto.pages.dev</a>라는 사이트가 있는데요.</p>
<p>이 사이트는 Next.js를 이용한 정적사이트입니다.</p>
<p>단순하게 Github 연동 후에 git push만 하면 Cloudflare가 알아서 빌드 후 Pages에 올려주죠.</p>
<p>Cloudflare가 제안하는 방법은 Github을 이용한 방식인데요.</p>
<p>저는 커맨드라인 명령어인 wrangler를 사용해서 Pages 앱 만들기, 그리고 배포(deploy)까지 해 보겠습니다.</p>
<p>그럼 wrangler 명령어를 설치해야 하는데요.</p>
<p>npm으로 글로벌하게 설치하는 방법도 있고, 해당 앱에 로컬로 설치하는 방법도 있습니다.</p>
<p>최근 추세인 로컬에 wrangler 앱을 설치하겠습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install -D wrangler
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler
</span></span><span class="line"><span class="cl">wrangler
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Commands:
</span></span><span class="line"><span class="cl">  wrangler docs <span class="o">[</span>command..<span class="o">]</span>            📚 Open wrangler<span class="err">&#39;</span>s docs in your browser
</span></span><span class="line"><span class="cl">  wrangler init <span class="o">[</span>name<span class="o">]</span>                 📥 Initialize a basic Worker project, including a wrangler.toml file
</span></span><span class="line"><span class="cl">  wrangler generate <span class="o">[</span>name<span class="o">]</span> <span class="o">[</span>template<span class="o">]</span>  ✨ Generate a new Worker project from an existing Worker template. See https://github.com/cloudflare/templates
</span></span><span class="line"><span class="cl">  wrangler dev <span class="o">[</span>script<span class="o">]</span>                👂 Start a <span class="nb">local</span> server <span class="k">for</span> developing your worker
</span></span><span class="line"><span class="cl">  wrangler deploy <span class="o">[</span>script<span class="o">]</span>             🆙 Deploy your Worker to Cloudflare.  <span class="o">[</span>aliases: publish<span class="o">]</span>
</span></span><span class="line"><span class="cl">  wrangler delete <span class="o">[</span>script<span class="o">]</span>             🗑  Delete your Worker from Cloudflare.
</span></span><span class="line"><span class="cl">  wrangler tail <span class="o">[</span>worker<span class="o">]</span>               🦚 Starts a log tailing session <span class="k">for</span> a published Worker.
</span></span><span class="line"><span class="cl">  wrangler secret                      🤫 Generate a secret that can be referenced in a Worker
</span></span><span class="line"><span class="cl">  wrangler secret:bulk <span class="o">[</span>json<span class="o">]</span>          🗄️  Bulk upload secrets <span class="k">for</span> a Worker
</span></span><span class="line"><span class="cl">  wrangler kv:namespace                🗂️  Interact with your Workers KV Namespaces
</span></span><span class="line"><span class="cl">  wrangler kv:key                      🔑 Individually manage Workers KV key-value pairs
</span></span><span class="line"><span class="cl">  wrangler kv:bulk                     💪 Interact with multiple Workers KV key-value pairs at once
</span></span><span class="line"><span class="cl">  wrangler pages                       ⚡️ Configure Cloudflare Pages
</span></span><span class="line"><span class="cl">  wrangler queues                      🇶 Configure Workers Queues
</span></span><span class="line"><span class="cl">  wrangler r2                          📦 Interact with an R2 store
</span></span><span class="line"><span class="cl">  wrangler dispatch-namespace          📦 Interact with a dispatch namespace
</span></span><span class="line"><span class="cl">  wrangler d1                          🗄  Interact with a D1 database
</span></span><span class="line"><span class="cl">  wrangler hyperdrive                  🚀 Configure Hyperdrive databases
</span></span><span class="line"><span class="cl">  wrangler ai                          🤖 Interact with AI models
</span></span><span class="line"><span class="cl">  wrangler constellation               🤖 Interact with Constellation models
</span></span><span class="line"><span class="cl">  wrangler vectorize                   🧮 Interact with Vectorize indexes
</span></span><span class="line"><span class="cl">  wrangler pubsub                      📮 Interact and manage Pub/Sub Brokers
</span></span><span class="line"><span class="cl">  wrangler mtls-certificate            🪪 Manage certificates used <span class="k">for</span> mTLS connections
</span></span><span class="line"><span class="cl">  wrangler login                       🔓 Login to Cloudflare
</span></span><span class="line"><span class="cl">  wrangler <span class="nb">logout</span>                      🚪 Logout from Cloudflare
</span></span><span class="line"><span class="cl">  wrangler whoami                      🕵️  Retrieve your user info and <span class="nb">test</span> your auth config
</span></span><span class="line"><span class="cl">  wrangler types                       📝 Generate types from bindings <span class="p">&amp;</span> module rules in config
</span></span><span class="line"><span class="cl">  wrangler deployments                 🚢 List and view details <span class="k">for</span> deployments
</span></span><span class="line"><span class="cl">  wrangler rollback <span class="o">[</span>deployment-id<span class="o">]</span>    🔙 Rollback a deployment
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flags:
</span></span><span class="line"><span class="cl">  -j, --experimental-json-config  Experimental: Support wrangler.json  <span class="o">[</span>boolean<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -c, --config                    Path to .toml configuration file  <span class="o">[</span>string<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -e, --env                       Environment to use <span class="k">for</span> operations and .env files  <span class="o">[</span>string<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -h, --help                      Show <span class="nb">help</span>  <span class="o">[</span>boolean<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -v, --version                   Show version number  <span class="o">[</span>boolean<span class="o">]</span>
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt;</span></span></code></pre></div>
  </figure>
</div>
<p>&rsquo;npx wrangler&rsquo;라고 치면 wrangler 명령어의 도움말이 나오는데요.</p>
<p>이 wrangler라는 커맨드라인 명령어가 Cloudflare의 모든 서비스를 CLI 상태에서 이용하게 해 줍니다.</p>
<p>그럼 지금 만들었던 React 앱에서 TailwindCSS는 초기화했고, App.tsx 파일만 조금 수정해 보겠습니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// src/App.tsx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;./App.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;text-2xl font-bold flex justify-center items-center p-8&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Welcome</span> <span class="nx">to</span> <span class="nx">React</span> <span class="kd">with</span> <span class="nx">Pages</span> <span class="o">+</span> <span class="nx">Workers</span> <span class="o">+</span> <span class="nx">D1</span> <span class="nx">Example</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span></span></span></code></pre></div>
  </figure>
</div>
<p>App.css 안에 있는 내용도 다 지우시면 됩니다.</p>
<p>&ldquo;npm run dev&rdquo; 명령어로 React 앱이 제대로 작동되는지 한 번 볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEhTX6AsFVTjdeKC-zowdgVZbjiw5KQNhDP6MSeE5fsjucQqm1jt3fAGGlXU85Zhy6bywjwEfC_F4J5apF93Ih_1kWYTYIZgB_Iilo7UrhhZxeTY6lDW_DzF2vmcRKcEyl17dW9gJ0zt75Kzg9FOyJFviqanG1E8E8Pg9lVG57FT5v4MFhvKGd1aXVBP3aQ"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위와 같이 우리가 만든 앱이 제대로 나오고 있습니다.</p>
<p>이제 이걸 Cloudflare EDGE 서버에 올리는 게 다음 순서인데요.</p>
<p>Pages는 정적사이트 호스팅 서비스라고 했었잖아요.</p>
<p>그래서 우리 React 앱을 build 해야 합니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npm run build
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; cloudflare-pages-d1-stack-example@0.0.0 build
</span></span><span class="line"><span class="cl">&gt; tsc <span class="o">&amp;&amp;</span> vite build
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vite v5.0.6 building <span class="k">for</span> production...
</span></span><span class="line"><span class="cl">✓ <span class="m">32</span> modules transformed.
</span></span><span class="line"><span class="cl">dist/index.html                   0.46 kB │ gzip:  0.30 kB
</span></span><span class="line"><span class="cl">dist/assets/index-sWUpnV8R.css    4.72 kB │ gzip:  1.47 kB
</span></span><span class="line"><span class="cl">dist/assets/index-UJjASkPh.js   142.83 kB │ gzip: 45.90 kB
</span></span><span class="line"><span class="cl">✓ built in 2.29s
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; tree --du -h ./dist
</span></span><span class="line"><span class="cl"><span class="o">[</span>146K<span class="o">]</span>  ./dist
</span></span><span class="line"><span class="cl">├── <span class="o">[</span>144K<span class="o">]</span>  assets
</span></span><span class="line"><span class="cl">│   ├── <span class="o">[</span>139K<span class="o">]</span>  index-UJjASkPh.js
</span></span><span class="line"><span class="cl">│   └── <span class="o">[</span>4.6K<span class="o">]</span>  index-sWUpnV8R.css
</span></span><span class="line"><span class="cl">├── <span class="o">[</span> 464<span class="o">]</span>  index.html
</span></span><span class="line"><span class="cl">└── <span class="o">[</span>1.5K<span class="o">]</span>  vite.svg</span></span></code></pre></div>
  </figure>
</div>
<p>dist 폴더에 빌드 된 리액트 앱이 생성됩니다.</p>
<p>총 146K 크기네요.</p>
<p>React가 용량이 있긴 있네요.</p>
<p>그런 면에서는 AstroJS가 정적 사이트에서는 최고인데요.</p>
<p>그래도 React의 JSX가 저는 훨씬 좋습니다.</p>
<p>SvelteJS나 VueJS도 잠깐 해봤는데요.</p>
<p>React의 JSX에 익숙해서인지 결국에는 다시 React로 돌아오게 되더군요.</p>
<p>AstroJS도 React를 렌더링 엔진으로 사용할 수 있어 최근에 AstroJS에도 빠졌었는데요.</p>
<p>AstroJS는 제 지난 강좌가 있으니 꼭 찾아보시기 바랍니다.</p>
<p><a href="https://mycodingshub.github.io/blog/2023-10-07-astrojs-tutorial-how-to-handle-data-in-astrojs">AstroJS 강좌 1편</a></p>
<p>이제 Cloudflare에 dist란 폴더를 올리면 됩니다.</p>
<p>먼저, Cloudflare에 로그인해야 하는데요.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler login
</span></span><span class="line"><span class="cl"> ⛅️ wrangler 3.19.0
</span></span><span class="line"><span class="cl">-------------------
</span></span><span class="line"><span class="cl">Attempting to login via OAuth...
</span></span><span class="line"><span class="cl">Opening a link in your default browser: https://dash.cloudflare.com/oauth2/auth?response_type<span class="o">=</span>code<span class="p">&amp;</span><span class="nv">client_id</span><span class="o">=</span>54d11594-84e4-41aa-b438-e81b8fa78ee7<span class="p">&amp;</span><span class="nv">redirect_uri</span><span class="o">=</span>http%3A%2F%2Flocalhost%3A8976%2Foauth%2Fcallback<span class="p">&amp;</span><span class="nv">scope</span><span class="o">=</span>account%3Aread%20user%3Aread%20workers%3Awrite%20workers_kv%3Awrite%20workers_routes%3Awrite%20workers_scripts%3Awrite%20workers_tail%3Aread%20d1%3Awrite%20pages%3Awrite%20zone%3Aread%20ssl_certs%3Awrite%20constellation%3Awrite%20ai%3Aread%20offline_access<span class="p">&amp;</span><span class="nv">state</span><span class="o">=</span>uVwuHca-XoL3XUs0vvn-t94Rfc4Ivtab<span class="p">&amp;</span><span class="nv">code_challenge</span><span class="o">=</span>Of_FujfUjvsu6R0jICrg1ue7f-mMV8lCQ6o<span class="p">&amp;</span><span class="nv">code_challenge_method</span><span class="o">=</span>S256
</span></span><span class="line"><span class="cl">Successfully logged in.
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example</span></span></code></pre></div>
  </figure>
</div>
<p>아마 브라우저가 뜨면서 로그인하라고 하고 권한을 달라고 할 겁니다.</p>
<p>권한을 주면 위와 같이 터미널상에서 본격적인 wrangler 명령어를 사용할 수 있게 됩니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler pages deploy ./dist
</span></span><span class="line"><span class="cl">No project selected. Would you like to create one or use an existing project?
</span></span><span class="line"><span class="cl">❯ Create a new project
</span></span><span class="line"><span class="cl">  Use an existing project
</span></span><span class="line"><span class="cl">✔ Enter the name of your new project: … pages-d1-fullstack-example
</span></span><span class="line"><span class="cl">✔ Enter the production branch name: … production
</span></span><span class="line"><span class="cl">✨ Successfully created the <span class="s1">&#39;pages-d1-fullstack-example&#39;</span> project.
</span></span><span class="line"><span class="cl">🌎  Uploading... <span class="o">(</span>4/4<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">✨ Success! Uploaded <span class="m">4</span> files <span class="o">(</span>1.52 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">✨ Deployment complete! Take a peek over at https://eaa75f17.pages-d1-fullstack-example.pages.dev
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt;</span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 wrangler 명령어 중에 pages 항목에서 바로 deploy 명령어를 사용했습니다.</p>
<p>끝에는 업로드하고 싶은 폴더, 즉 우리는 React 앱이 컴파일된 &lsquo;dist&rsquo; 폴더를 통채로 올리는 거죠.</p>
<p>위와 같이 명령어를 사용하면 두 가지를 물어보는데요.</p>
<p>현재 폴더를 업로드하는 거라 &ldquo;Create a new project&rdquo; 부분을 누른 다음 원하는 이름을 적으시면 됩니다.</p>
<p>그리고 &lsquo;github branch name&rsquo;을 물으면 그냥 엔터 치면 자동으로 production이라고 설정됩니다.</p>
<p>이제 위와 같이 &lsquo;Uploaded&rsquo;라는 문구와 함께 최종적으로 홈페이지가 만들어졌다고 나옵니다.</p>
<p>한 번 그 주소를 클릭해서 브라우저에서 보시기 바랍니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjQioRBExfyueaN-1bNQgreDbs1F6ZuSTw8nM8V2W-cBDEO-0d49r6wFl9_A-aIUVERdEJt2hhcx9jCjaHUn7OhnX1dNH6Y2uCm22Fho83tWzYBFRi1l7o6d01cEMbNRvxZfcncqqcA8DOCnWSmYkCTqE7IaPhQVA2S4Z_FUj5iQUSzeRvBJUczCXzVUWk"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위와 같이 브라우저에서도 잘 나옵니다.</p>
<p>실제 Cloudflare 대시보드에 가보면 아래와 같이 나오는데요.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjbZIhX62Jorg8ZVx6jYc8TTWyiSGx5NpmDmfMwXTGY2wxTIuYvzUZYsT4GBaf-KNG9BgBnkRHQfsxUk97ipAlm3S8uV050W7sPha9twr-n5TTpi0JkyqT7-_NDg8r3e4eCmlg8P4wrHQd6ARoiVpCoM8po4dfb2-Qali6eMtDtapRhTn6fpyypMFA0s9Y"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위와 같이 아까 우리가 입력했던 project 이름이 그대로 나옵니다.</p>
<p>그리고 주소도 터미널 창에 있던 주소와 사뭇 다른데요.</p>
<p>대시보드에 있는 게 정식 주소고 터미널 창에 있는 거는 개발용 임시 서버입니다.</p>
<p>그리고 아래 그림과 같이 빌드 시점까지 다 나오고 있습니다.</p>
<p>대시보드에서는 Settings 부분을 선택해서 여러 가지 설정을 할 수 있는데요.</p>
<p>그건 나중에 알아보겠습니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEi3rU0DGRGShLMo-7-AzDPoezkTdDUKxKd_F3s6YXbKhWENB33Xqv5W4DgP4TibriI50KK9UkhkbyF3Xl9ox_BKQZIhKs2WMT3zwgIWlyD1d6xY4JASuQVYodbDSAINItlVBr8DAA838k2z0OnODrivXRQeIh2iZ5g87cmRpNB4QwADcZ49uW9A7HdI5mo"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>참고로, 제가 <code>npx wrangler init</code> 명령어를 사용하지 않았는데요.</p>
<p><code>npx wrangler init</code> 명령어는 바로 Cloudflare 앱을 만드는 명령어입니다.</p>
<p>빈 디렉토리에서 한 번 해보십시오.</p>
<p>React 구성이 예전 create-react-app을 사용하고 있어 너무 느립니다.</p>
<p>그래서 제가 사용하는 방식은 Vite를 이용한 React 앱 구성 후 Cloudflare 서비스를 연결하는 겁니다.</p>
<p>일단 정적 사이트 호스팅이 완료되었네요.</p>
<hr>
<h2 id="3-workers-이용하여-백엔드-로직-구현하기">3. Workers 이용하여 백엔드 로직 구현하기</h2>
<p>Cloudflare Workers는 서버리스 함수인데요.</p>
<p>Vercel, Netlify에도 있는 그 서버리스 함수입니다.</p>
<p>간단한 로직으로 백엔드 로직을 구현할 수 있는데요.</p>
<p>Cloudflare는 Workers를 따로 제공해 주는데요.</p>
<p>보통 자기 계정 이름과 함께 Workers 앱이 구현됩니다.</p>
<p>그래서 저 같은 경우 cpro95.workers.dev라는 서브 도메인이 있습니다.</p>
<p>그래서 workers를 새로 만들면 xxx.cpro95.workers.dev라는 주소가 되는 거죠.</p>
<p>물론 계정 이름 말고 다른 걸로 서브 도메인 이름을 정할 수 있습니다.</p>
<p>자기만의 workers를 만들어 놓으면 자신만의 API를 구현할 수 있는 장점이 있고,</p>
<p>심지어, workers를 이용하여 직접 서버사이드 렌더링되는 홈페이지까지 구현할 수 있습니다.</p>
<p>이 부분은 다음에 다뤄보기로 하고, 오늘은 Workers를 Pages 내에서 사용하는 방법에 대해 알아보겠습니다.</p>
<p>참고로 Cloudflare는 정책적으로 workers를 향후 Pages 안에서 구현하도록 권장하고 있습니다.</p>
<p>Workers 구현을 Pages에서 하려면 프로젝트 최상단에 functions라는 폴더를 만들고 그 밑에 js 파일을 만들면 됩니다.</p>
<p>참고로 js 파일이름은 그대로 하나의 라우팅 주소가 되기 때문에 적당한 이름을 사용하시면 됩니다.</p>
<p>보통 API를 구현하는 거기 때문에 functions/api 폴더를 많이 만들죠.</p>
<p>이제 여기에 hello.js라는 파일을 만들어 보겠습니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// functions/api/hello.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">onRequest</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s2">&#34;Hello World!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>workers 함수는 위와 같이 onRequest 함수를 구현해야 하며 해당 함수는 Response를 리턴해야 합니다.</p>
<p>그리고 onRequest 함수는 ctx라는 Context라는 객체를 제공하는데요.</p>
<p>이 ctx라는 객체로 여러 가지 일을 할 수 있습니다.</p>
<p>일단 위와 같이 하고 저장합시다.</p>
<p>그리고 다시 npm run build 안 하고 그냥 바로 deploy만 해 보겠습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler pages deploy ./dist
</span></span><span class="line"><span class="cl">✨ Compiled Worker successfully
</span></span><span class="line"><span class="cl">🌍  Uploading... <span class="o">(</span>4/4<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">✨ Success! Uploaded <span class="m">0</span> files <span class="o">(</span><span class="m">4</span> already uploaded<span class="o">)</span> <span class="o">(</span>0.51 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">✨ Uploading Functions bundle
</span></span><span class="line"><span class="cl">✨ Deployment complete! Take a peek over at https://08bfc080.pages-d1-fullstack-example.pages.dev
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt;</span></span></code></pre></div>
  </figure>
</div>
<p>아까와 다른 점은 wrangler 명령어가 알아서 Worker 부분을 알아채고 Worker 로직도 함께 Cloudflare Pages에 올려 줍니다.</p>
<p>이제 우리가 만든 Workers가 제대로 작동하는지 보기 위해 아래와 같은 주소로 이동해 봅시다.</p>
<p>우리가 만든 hello.js 파일에 따라 주소는 &ldquo;api/hello&quot;가 됩니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEinJLTFd-TDEdPYkPGE2tvqfNCmiI6LrStCzGXUejg-mZShyzY_OKSeOK5KwnWPb-Afhn1kWq-P1H7q9uhPaAdE32BUlQgAdDuWi1ET1y_CZeeRYCAqYyCc7ATLkB44dbDGHxLfrvREtdL-ltYk48pL6oTlAZernqgSFIwan4shDBY6CE7M1AP0sNcCvNI"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림과 같이 Cloudflare 엣지 서버에 제가 만든 API가 올라갔습니다.</p>
<p>이제 백엔드 로직을 구현할 모든 준비가 끝났습니다.</p>
<p>잠깐, 여기서 계속 Cloudflare 엣지 서버에 정식으로 배포(deploy) 하지 말고 개발 서버를 돌려서 확인할 방법이 없을까요?</p>
<p>wrangler 명령어는 dev 키워드를 제공합니다.</p>
<p>해당 키워드가 그걸 지원해 주는데요.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler pages dev ./dist
</span></span><span class="line"><span class="cl">▲ <span class="o">[</span>WARNING<span class="o">]</span> No compatibility_date was specified. Using today<span class="err">&#39;</span>s date: 2023-12-06.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Pass it in your terminal:
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  --compatibility-date<span class="o">=</span>2023-12-06
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  See https://developers.cloudflare.com/workers/platform/compatibility-dates/ <span class="k">for</span> more information.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Compiling worker to <span class="s2">&#34;/Users/cpro95/Codings/Javascript/blog/cloudflare-pages-d1-stack-example/.wrangler/tmp/pages-9wdp2v/functionsWorker-0.4568567797378653.mjs&#34;</span>...
</span></span><span class="line"><span class="cl">✨ Compiled Worker successfully
</span></span><span class="line"><span class="cl"> ⛅️ wrangler 3.19.0
</span></span><span class="line"><span class="cl">-------------------
</span></span><span class="line"><span class="cl">▲ <span class="o">[</span>WARNING<span class="o">]</span> --local is no longer required and will be removed in a future version.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="sb">`</span>wrangler dev<span class="sb">`</span> now uses the <span class="nb">local</span> Cloudflare Workers runtime by default. 🎉
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">⎔ Starting <span class="nb">local</span> server...
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> Ready on http://localhost:8788
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET / <span class="m">200</span> OK <span class="o">(</span>44ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /assets/index-UJjASkPh.js <span class="m">200</span> OK <span class="o">(</span>32ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /assets/index-sWUpnV8R.css <span class="m">200</span> OK <span class="o">(</span>72ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /api/hello <span class="m">200</span> OK <span class="o">(</span>3ms<span class="o">)</span>
</span></span><span class="line"><span class="cl">✨ Compiled Worker successfully
</span></span><span class="line"><span class="cl">⎔ Reloading <span class="nb">local</span> server...
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /api/hello <span class="m">200</span> OK <span class="o">(</span>10ms<span class="o">)</span>
</span></span><span class="line"><span class="cl">╭─────────────────────────────────────────────────────────────────────────────────────────────────────╮
</span></span><span class="line"><span class="cl">│ <span class="o">[</span>b<span class="o">]</span> open a browser, <span class="o">[</span>d<span class="o">]</span> open Devtools, <span class="o">[</span>c<span class="o">]</span> clear console, <span class="o">[</span>x<span class="o">]</span> to <span class="nb">exit</span>                               │
</span></span><span class="line"><span class="cl">╰─────────────────────────────────────────────────────────────────────────────────────────────────────╯</span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 나오는데요. 여기서 &lsquo;b&rsquo; 키를 누르면 브라우저가 바로 뜹니다.</p>
<p>그래고 hello.js 파일의 내용을 고쳐볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEi-dJN4KccwAamWfwOZghENJw-6pdTkdjA_PeHdpQm53FyJl7Yh4kLeMYlEJ5h0sEtHVqc0Lt0J1uQLW94nzw5IqhsAyyLTfF_gbJdcxxgZQ8jfCF9BePE4veaVBScFW5TKteqxPeOEs2C0u_lld7wo5YitZSu7GTeLl1mb8KNWC47bPKBYGc95tRzzmSY"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림과 같이 브라우저를 새로고침 하면 바로 반영됩니다.</p>
<p>어떤가요?</p>
<p>workers 부분에 대한 개발 서버 구축이 완료되었는데요.</p>
<p>그러면 React 부분의 Hot-Reloading 부분은 어떻게 할까요?</p>
<p>package.json 파일의 scripts 부분에 아래와 같이 만듭니다.</p>



<div class="expressive-code">
  <figure class="frame not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl">  <span class="s2">&#34;scripts&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dev:ui&#34;</span><span class="p">:</span> <span class="s2">&#34;vite&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="s2">&#34;wrangler pages dev --compatibility-date=2023-12-06 -- npm run dev:ui&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;tsc &amp;&amp; vite build&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;lint&#34;</span><span class="p">:</span> <span class="s2">&#34;eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;preview&#34;</span><span class="p">:</span> <span class="s2">&#34;vite preview&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="err">,</span></span></span></code></pre></div>
  </figure>
</div>
<p>고친 거는 dev:ui 부분과 dev 부분입니다.</p>
<p>그리고 wranger 부분에 &lsquo;&ndash;compatibility-date=2023-12-06&rsquo; 이라는 옵션을 넣었는데요.</p>
<p>이 부분을 넣어줘야 호환성 부분을 정확히 제공할 수 있어 wrangler가 하라는 데로 넣으시면 됩니다.</p>
<p>간혹 날짜 부분이 예전 날짜가 나올 수 있으니까, wrangler가 지시하는 날짜를 넣으시면 됩니다.</p>
<p>이제, &rsquo;npm run dev&rsquo;를 통해 React 부분의 핫 리로딩을 테스트해 보겠습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">MiniflareCoreError <span class="o">[</span>ERR_RUNTIME_FAILURE<span class="o">]</span>: The Workers runtime failed to start. There is likely additional logging output above.
</span></span><span class="line"><span class="cl">    at <span class="c1">#assembleAndUpdateConfig (/Users/cpro95/Codings/Javascript/blog/cloudflare-pages-d1-stack-example/node_modules/miniflare/dist/src/index.js:8889:13)</span>
</span></span><span class="line"><span class="cl">    at process.processTicksAndRejections <span class="o">(</span>node:internal/process/task_queues:95:5<span class="o">)</span>
</span></span><span class="line"><span class="cl">    at async Mutex.runWith <span class="o">(</span>/Users/cpro95/Codings/Javascript/blog/cloudflare-pages-d1-stack-example/node_modules/miniflare/dist/src/index.js:3861:16<span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  code: <span class="s1">&#39;ERR_RUNTIME_FAILURE&#39;</span>,
</span></span><span class="line"><span class="cl">  cause: undefined
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </figure>
</div>
<p>개발 서버를 돌리면 위와 같이 MiniflareCoreError가 간혹 나오는데요.</p>
<p>이 경우는 wranger dev 명령어가 중복됐다는 의미가 거의 99%입니다.</p>
<p>다른 터미널에 개발 서버를 열어 놨거나, 아니면 &lsquo;workerd&rsquo; 라는 명령어가 백그라운드에서 제대로 kill 되지 않아서 일 겁니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">killall workerd</span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 터미널상에서 &lsquo;workerd&rsquo; 라는 worker demon을 모두 죽이면 됩니다.</p>
<p>윈도우 사용자라면 taskkill을 이용하시거나 백그라운드 프로세스를 찾아서 죽이시면 됩니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; killall workerd
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npm run dev
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; cloudflare-pages-d1-stack-example@0.0.0 dev
</span></span><span class="line"><span class="cl">&gt; wrangler pages dev --compatibility-date<span class="o">=</span>2023-12-06 -- npm run dev:ui
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Running npm run dev<span class="se">\:</span>ui...
</span></span><span class="line"><span class="cl">Sleeping <span class="m">5</span> seconds to allow proxy process to start before attempting to automatically determine port...
</span></span><span class="line"><span class="cl">To skip, specify the proxy port with --proxy.
</span></span><span class="line"><span class="cl"><span class="o">[</span>proxy<span class="o">]</span>:
</span></span><span class="line"><span class="cl">&gt; cloudflare-pages-d1-stack-example@0.0.0 dev:ui
</span></span><span class="line"><span class="cl">&gt; vite
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>proxy<span class="o">]</span>: Port <span class="m">5173</span> is in use, trying another one...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>proxy<span class="o">]</span>:
</span></span><span class="line"><span class="cl">  VITE v5.0.6  ready in <span class="m">367</span> ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>proxy<span class="o">]</span>:   ➜  Local:   http://localhost:5174/
</span></span><span class="line"><span class="cl">  ➜  Network: use --host to expose
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Automatically determined the proxy port to be 5174.
</span></span><span class="line"><span class="cl">Compiling worker to <span class="s2">&#34;/Users/cpro95/Codings/Javascript/blog/cloudflare-pages-d1-stack-example/.wrangler/tmp/pages-zIsHrF/functionsWorker-0.18787902221672237.mjs&#34;</span>...
</span></span><span class="line"><span class="cl">✨ Compiled Worker successfully
</span></span><span class="line"><span class="cl"> ⛅️ wrangler 3.19.0
</span></span><span class="line"><span class="cl">-------------------
</span></span><span class="line"><span class="cl">▲ <span class="o">[</span>WARNING<span class="o">]</span> --local is no longer required and will be removed in a future version.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="sb">`</span>wrangler dev<span class="sb">`</span> now uses the <span class="nb">local</span> Cloudflare Workers runtime by default. 🎉
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">⎔ Starting <span class="nb">local</span> server...
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> Ready on http://localhost:8788
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET / <span class="m">200</span> OK <span class="o">(</span>106ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /@vite/client <span class="m">200</span> OK <span class="o">(</span>541ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /@react-refresh <span class="m">304</span> Not Modified <span class="o">(</span>401ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /src/main.tsx <span class="m">200</span> OK <span class="o">(</span>576ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /node_modules/vite/dist/client/env.mjs <span class="m">304</span> Not Modified <span class="o">(</span>351ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /src/App.tsx <span class="m">200</span> OK <span class="o">(</span>337ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /src/App.css <span class="m">200</span> OK <span class="o">(</span>55ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /src/index.css <span class="m">200</span> OK <span class="o">(</span>417ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET / <span class="m">101</span> Switching Protocols <span class="o">(</span>60ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /node_modules/.vite/deps/react.js <span class="m">200</span> OK <span class="o">(</span>480ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /node_modules/.vite/deps/react_jsx-dev-runtime.js <span class="m">200</span> OK <span class="o">(</span>495ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /node_modules/.vite/deps/react-dom_client.js <span class="m">200</span> OK <span class="o">(</span>541ms<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wrangler:inf<span class="o">]</span> GET /node_modules/.vite/deps/chunk-4YP5LC2O.js <span class="m">200</span> OK <span class="o">(</span>338ms<span class="o">)</span>
</span></span><span class="line"><span class="cl">╭─────────────────────────────────────────────────────────────────────────────────────────────────────╮
</span></span><span class="line"><span class="cl">│ <span class="o">[</span>b<span class="o">]</span> open a browser, <span class="o">[</span>d<span class="o">]</span> open Devtools, <span class="o">[</span>c<span class="o">]</span> clear console, <span class="o">[</span>x<span class="o">]</span> to <span class="nb">exit</span>                               │
</span></span><span class="line"><span class="cl">╰─────────────────────────────────────────────────────────────────────────────────────────────────────╯</span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 나오는데요.</p>
<p>저 같은 경우 기존 5173 포트가 누가 사용하고 있다고 나오는데요.</p>
<p>이건 Vite 버그 같습니다.</p>
<p>예전 dev 서버가 완전히 죽지 않는 버그인데요.</p>
<p>kill 명령어를 통해 죽여주면 됩니다.</p>
<p>이제, App.tsx 파일에서 일부 문구를 변경해 보세요.</p>
<p>그림으로 캡처를 안 했는데, 100% 제대로 작동하고 있는 걸 볼 수 있을 겁니다.</p>
<p>이제 개발 서버 구현은 모두 끝났네요.</p>
<hr>
<h2 id="4-d1-데이터베이스-사용하기">4. D1 데이터베이스 사용하기</h2>
<p>Cloudflare가 DB 서비스로 제공하는 D1이라는 서비스가 있는데요.</p>
<p>아직은 베타입니다.</p>
<p>그래도 사용은 할 정도로 꽤 안정화되었고, 무엇보다 빠르고 무료라는 점입니다.</p>
<p>5G까지 무료인데요.</p>
<p>Workers 무료 사용자라면 무조건 5G까지 무료입니다.</p>
<p>in, out 데이터 사용량 모두 사용했더라도 추가 요금을 부과하는 게 아니라 그냥 서비스가 정지되는 형태라 과금 걱정이 없습니다.</p>
<p>그리고 간단한 텍스트 저장으로는 5G 용량은 차고 넘치고요.</p>
<p>또 D1이 Sqlite 기반이라 너무 쉽습니다.</p>
<p>D1 DB 설정도 커맨드라인에서 wrangler 명령어를 사용해서 만들 겁니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler d1
</span></span><span class="line"><span class="cl">wrangler d1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">🗄  Interact with a D1 database
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Commands:
</span></span><span class="line"><span class="cl">  wrangler d1 list                List D1 databases
</span></span><span class="line"><span class="cl">  wrangler d1 info &lt;name&gt;         Get information about a D1 database, including the current database size and state.
</span></span><span class="line"><span class="cl">  wrangler d1 create &lt;name&gt;       Create D1 database
</span></span><span class="line"><span class="cl">  wrangler d1 delete &lt;name&gt;       Delete D1 database
</span></span><span class="line"><span class="cl">  wrangler d1 backup              Interact with D1 Backups
</span></span><span class="line"><span class="cl">  wrangler d1 execute &lt;database&gt;  Executed <span class="nb">command</span> or SQL file
</span></span><span class="line"><span class="cl">  wrangler d1 time-travel         Use Time Travel to restore, fork or copy a database at a specific point-in-time.
</span></span><span class="line"><span class="cl">  wrangler d1 migrations          Interact with D1 Migrations
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flags:
</span></span><span class="line"><span class="cl">  -j, --experimental-json-config  Experimental: Support wrangler.json  <span class="o">[</span>boolean<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -c, --config                    Path to .toml configuration file  <span class="o">[</span>string<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -e, --env                       Environment to use <span class="k">for</span> operations and .env files  <span class="o">[</span>string<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -h, --help                      Show <span class="nb">help</span>  <span class="o">[</span>boolean<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -v, --version                   Show version number  <span class="o">[</span>boolean<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------
</span></span><span class="line"><span class="cl">🚧 D1 is currently in open beta
</span></span><span class="line"><span class="cl">🚧 Please report any bugs to https://github.com/cloudflare/workers-sdk/issues/new/choose
</span></span><span class="line"><span class="cl">--------------------</span></span></code></pre></div>
  </figure>
</div>
<p>d1 서비스의 명령어 도움말 화면입니다.</p>
<p>당연히 create 명령어를 사용 해야겠네요.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler d1 create pages-d1-stack
</span></span><span class="line"><span class="cl">✅ Successfully created DB <span class="s1">&#39;pages-d1-stack&#39;</span> in region APAC
</span></span><span class="line"><span class="cl">Created your database using D1<span class="err">&#39;</span>s new storage backend. The new storage backend is not yet recommended
</span></span><span class="line"><span class="cl"><span class="k">for</span> production workloads, but backs up your data via point-in-time restore.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[[</span>d1_databases<span class="o">]]</span>
</span></span><span class="line"><span class="cl"><span class="nv">binding</span> <span class="o">=</span> <span class="s2">&#34;DB&#34;</span> <span class="c1"># i.e. available in your Worker on env.DB</span>
</span></span><span class="line"><span class="cl"><span class="nv">database_name</span> <span class="o">=</span> <span class="s2">&#34;pages-d1-stack&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">database_id</span> <span class="o">=</span> <span class="s2">&#34;2ddfdc8f4-9601-4ae2-aeaa-12adfasdf6d8820f&#34;</span></span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 create 명령어 뒤에 이름을 작성하면 위 그림과 같이 d1_database가 생성되고 해당 정보를 보여줍니다.</p>
<p>위 정보는 아주 중요한데요.</p>
<p>특히 database_id가 가장 중요합니다.</p>
<p>database_id는 대시보드의 D1 부분에 가도 아래 그림처럼 나옵니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEhf4jC4FJhtajxkpHH-Pyx2Cr0bdYFaAWlF3SvfFL4lQEa_jjBy0HpDmeQi7LoG_xMF0qj_cZG90Ao_0PsiZkwV9Ao_wuVEDgsrwI0oYgt9TdSFqWat-cvM6ARIqvkvDgOm8fPMs0hWtOcpIfp2vn16ELqipPfVNJNax_qgpunw_3LIDRePfMOLJ2zNADk"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위 그림에서 방금 만든 pages-d1-stack 이름을 누르면 아래 그림처럼 나오는데요.</p>
<p>테이블이 없다고 나옵니다.</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEgSt4P9LhiE8gThxkKdEIA_1jIzkeOtqiAIwLKMUvWPZ7CjmJY-M_4Z_9tL3Ru7Xj0zLhcDe8e_rCHd_hFh1rhmCEhaHPHexVcag1LS8gT7obBo2v17w-FEgymQUxN3Daz_97GzSwty54x_8GxcggqDIWkHX53VdXs9w-2cUxsAuyZftaqdi5hzW1kyvrQ"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>이제 테이블을 만들어야 하는데요.</p>
<p>대시보드에서 직접 만들 수도 있고, 터미널상에서 sql 파일을 이용해서 만들 수도 있습니다.</p>
<p>저는 후자의 방식을 권장합니다.</p>
<p>나중에 자동화되는 배포 명령어를 구현하기 쉽거든요.</p>
<p>sql 파일은 프로젝트 최상단 폴더에서 아무 이름으로 만들면 됩니다.</p>
<p>저는 &ldquo;todos.sql&quot;이라고 했습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TABLE todos <span class="o">(</span>
</span></span><span class="line"><span class="cl">  id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span><span class="line"><span class="cl">  title TEXT NOT NULL,
</span></span><span class="line"><span class="cl">  desc TEXT NOT NULL,
</span></span><span class="line"><span class="cl">  created_at TIMESTAMP DEFAULT <span class="o">(</span>datetime<span class="o">(</span>CURRENT_TIMESTAMP,<span class="s1">&#39;localtime&#39;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">INSERT INTO todos<span class="o">(</span>title, desc<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">&#39;test title&#39;</span>,<span class="s1">&#39;test desc&#39;</span><span class="o">)</span><span class="p">;</span></span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 테이블 이름이 todos이란 이름으로 SQL에서 테이블 만드는 SQL 구문인데요.</p>
<p>테스트를 위해 더미 데이터도 넣는 INSERT 명령어 구문도 추가했습니다.</p>
<p>이제 이 sql 명령어를 D1 데이터베이스가 읽고 실행하게 해야 하는데요.</p>
<p>이 부분도 wrangler 명령어가 제공해 줍니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler d1 execute pages-d1-stack --file<span class="o">=</span>./todos.sql
</span></span><span class="line"><span class="cl">🌀 Mapping SQL input into an array of statements
</span></span><span class="line"><span class="cl">🌀 Parsing <span class="m">2</span> statements
</span></span><span class="line"><span class="cl">🌀 Executing on remote database pages-d1-stack <span class="o">(</span>2613c8f4-9601-4dd2-aeaa-126d5dd8820f<span class="o">)</span>:
</span></span><span class="line"><span class="cl">🌀 To execute on your <span class="nb">local</span> development database, pass the --local flag to <span class="s1">&#39;wrangler d1 execute&#39;</span>
</span></span><span class="line"><span class="cl">🚣 Executed <span class="m">2</span> commands in 0.7682ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt;</span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 npx wrangler d1 execute 명령어 뒤에 DB 네임을 적고 그다음 &lsquo;&ndash;file&rsquo; 옵션으로 아까 만든 todos.sql 파일을 지정해 주면 원격서버에서 해당 sql 문장을 실행하게 됩니다.</p>
<p>이제 Cloudflare 대시보드를 볼까요?</p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjOqNSmreQlbuwDdXzVtWSVs6qSO04LPDF6SuCLtEAO38vD12K4k-2qf9nL2SrKwSZ3eDTaBiharnCHtsT1Bfy27QOWg4cHforQiXC1LK4YUYuNMz6w2KezaYnDDZn1fpK1CsANoFFQYAfXnJt7sNAddA_QdxGP4sy6mJvnH1E8OvkmfL6ALceiAA5EaiY"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>
  <figure>
    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjDKDkC04vw0Simp8qm_ylBiDWIjXxWxaml5eYab9zEV40GMevHKckOtrwHJopDvJP0Sy0HeJsp9YPckG45eBx86Ko29zjZDY8o8HHL-KYUUJOkqjLzeAKMlU92_NobpUJgzQw6LO801MlxW_vUK7t5UAG-fNlukNsmJUtRbvjzXtnbBDg1irYwRfafcSI"
         alt=""
         
         class="img-fluid"
         loading="lazy"
         decoding="async" />
    
  </figure></p>
<p>위의 두 그림처럼 대시보드에서 완벽하게 D1 데이터베이스를 관리할 수 UI를 제공합니다.</p>
<p>여기서 하나 더 팁이 있는데요.</p>
<p>wrangler 명령어로 터미널에서 엣지 서버의 D1 데이터베이스에 접속해서 SQL 문을 실행할 수 있습니다.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt; npx wrangler d1 execute pages-d1-stack --command<span class="o">=</span><span class="s2">&#34;select * from todos;&#34;</span>
</span></span><span class="line"><span class="cl">🌀 Mapping SQL input into an array of statements
</span></span><span class="line"><span class="cl">🌀 Parsing <span class="m">1</span> statements
</span></span><span class="line"><span class="cl">🌀 Executing on remote database pages-d1-stack <span class="o">(</span>2613c8f4-9601-4dd2-aeaa-126d5dd8820f<span class="o">)</span>:
</span></span><span class="line"><span class="cl">🌀 To execute on your <span class="nb">local</span> development database, pass the --local flag to <span class="s1">&#39;wrangler d1 execute&#39;</span>
</span></span><span class="line"><span class="cl">🚣 Executed <span class="m">1</span> commands in 0.2841ms
</span></span><span class="line"><span class="cl">┌────┬────────────┬───────────┬─────────────────────┐
</span></span><span class="line"><span class="cl">│ id │ title      │ desc      │ created_at          │
</span></span><span class="line"><span class="cl">├────┼────────────┼───────────┼─────────────────────┤
</span></span><span class="line"><span class="cl">│ <span class="m">1</span>  │ <span class="nb">test</span> title │ <span class="nb">test</span> desc │ 2023-12-06 13:19:56 │
</span></span><span class="line"><span class="cl">└────┴────────────┴───────────┴─────────────────────┘
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">➜  cloudflare-pages-d1-stack-example&gt;</span></span></code></pre></div>
  </figure>
</div>
<p>현재 디렉토리가 길어서 명령어가 잘 안 보이는데요.</p>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npx wrangler d1 execute pages-d1-stack --command<span class="o">=</span><span class="s2">&#34;select * from todos;&#34;</span></span></span></code></pre></div>
  </figure>
</div>
<p>위와 같이 &lsquo;&ndash;command&rsquo; 명령어를 이용하면 됩니다.</p>
<p>이제, D1 데이터베이스를 사용하는 완벽한 방법을 숙지한 거 같네요.</p>
<p>그럼 2편에서 본격적인 D1 DB를 활용한 애플리케이션을 개발에 착수해 보겠습니다.</p>
<hr>

      <div class="tag-list-single">
        <a class="btn btn-light" href="/tags/cloudflare/" role="button">cloudflare</a>
        <a class="btn btn-light" href="/tags/pages/" role="button">pages</a>
        <a class="btn btn-light" href="/tags/d1/" role="button">d1</a>
        <a class="btn btn-light" href="/tags/workers/" role="button">workers</a>
        <a class="btn btn-light" href="/tags/react/" role="button">react</a>
        </div>
      
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-format="autorelaxed"
          data-ad-client="ca-pub-7748316956330968"
          data-ad-slot="4495825428"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</article>

      
      </div>
    </div>
    
    
<div class="bg-light">
    <section class="section section-related container">
      <div class="row justify-content-center">
        <div class="col-md-12 col-lg-12">
          <h2 class="section-title text-center">Related posts</h2>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-lg-12">
          <div class="card">
              <div class="card-body">
                <article>
                  <h2 class="h3"><a class="stretched-link text-body" href="/blog/2023-12-09-fullstack-cloudflare-pages-workers-d-1-react-part-2/">풀스택 강의 2편. Cloudflare Pages 안에서 Workers를 이용한 D1 DB 제어하는 API 만들기</a></h2>
                  <p>Workers로 D1 DB 불러오는 API 만들기</p>
                  <p>
  <small>December 9, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>12&nbsp;minutes</span></small>
</p>
</article>
              </div>
            </div>
          <div class="card">
              <div class="card-body">
                <article>
                  <h2 class="h3"><a class="stretched-link text-body" href="/blog/2023-12-10-fullstack-remix-cloudflare-pages-d-1-db-drizzle-orm/">풀스택 강의 4편. Remix &#43; Cloudflare Pages &#43; D1 DB &#43; Drizzle ORM</a></h2>
                  <p>풀스택 강의, Remix와 Pages, D1, Drizzle ORM으로 개발하기</p>
                  <p>
  <small>December 10, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>11&nbsp;minutes</span></small>
</p>
</article>
              </div>
            </div>
          <div class="card">
              <div class="card-body">
                <article>
                  <h2 class="h3"><a class="stretched-link text-body" href="/blog/2023-12-09-fullstack-astrojs-cloudflare-pages-d-1-drizzle-orm/">풀스택 강의 3편. AstroJS와 Cloudflare Pages, D1, Drizzle ORM으로 개발하기</a></h2>
                  <p>풀스택 개발하기 AstroJS + Cloudflare pages + D1 + Drizzle ORM</p>
                  <p>
  <small>December 9, 2023<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
        <path d="M12 7v5l3 3"></path>
      </svg>13&nbsp;minutes</span></small>
</p>
</article>
              </div>
            </div>
          </div>
      </div>
    </section>
    <script src="https://utteranc.es/client.js"
      repo="cpro95/utterances_mycodings_fly_dev"
      issue-term="pathname"
      theme="github-light"
      label="blog-comment"
      crossorigin="anonymous"
    async>
    </script>
  </div>
  
    <footer class="footer text-muted">
  <div class="container-lg">
    <div class="row">
      <div class="col-lg-8 text-center text-lg-start">
        <ul class="list-inline">
          <li class="list-inline-item"><a class="text-muted" href="/about/">about</a></li>
        </ul>
      </div>
      <div class="col-lg-8 text-center text-lg-end">
        <ul class="list-inline">
          <li class="list-inline-item">Copyright (c) All Right Reserved.</li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    

<script async
  src="/js/app.19b73e0182301dd61c9211c2f6890104740e2eb9eb12fe4ba8d4f31435b22ed6.js"
  integrity="sha256-Gbc&#43;AYIwHdYckhHC9okBBHQOLrnrEv5LqNTzFDWyLtY=">
</script>





<script async
  src="/js/flexsearch.5dd6433c29c3e043627f046054aed58ff3790f58fdb8423f45125bbafdcad335.js"
  integrity="sha256-XdZDPCnD4ENifwRgVK7Vj/N5D1j9uEI/RRJbuv3K0zU=">
</script>
<script async
  src="/js/search-modal.96e662d8f691fe25c859a3437074b485f2d7bed0bca612725028c6cf4322e2f2.js"
  integrity="sha256-luZi2PaR/iXIWaNDcHS0hfLXvtC8phJyUCjGz0Mi4vI=">
</script>

    <div class="d-inline-flex fixed-bottom-right pb-4 pe-4">
  <button id="toTop" type="button" class="btn btn-primary rounded-circle ms-auto p-2"><span class="visually-hidden">Top</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 15l6 -6l6 6"></path></svg></button>
</div>

    
  </body>
</html>
